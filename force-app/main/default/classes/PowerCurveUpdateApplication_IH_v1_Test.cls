/*
 * Integration Handler Test for PowerCurveUpdateApplication Service
 * @author Saurabh Pandey
 * @created 2020-11-17
 */

@isTest
public class PowerCurveUpdateApplication_IH_v1_Test {
    
    public static final String POSITIVE_RESPONSE_BODY = '{ "Response": { "ApplicationDV": { "APPAPPAPPLICATIONNUMBER": 46000132887, "APPERRMSG": "000", "DERPCOUNIQUENUMBER": "000000006590", "DerivedCalcAppData": { "DERAPPEXPO": { "REQPOTENTIALTFL": 275131, "REQPOTENTIALTGAE": 0, "REQPOTENTIALTGBE": 275131, "REQPOTENTIALTGOE": 275131, "REQPOTENTIALTOTDIRECT": 50001, "REQPOTENTIALTOTGROUP": 275131, "REQTOTADDPOTENTIALOC": 40388 }, "DERAPPGPAM": { "REQMAXTERMVSPURPSLOANMAXTERM": 0, "REQMAXTERMVSPURPSLOANNOTBOND": "N" }, "DERAPPPAPR": { "PREAPPRIND": "N", "PREAPPRREPROCESSLOWERLMTIND": "N" }, "DERAPPPRIN": { "PRINCAPPLICABLEIND": "Y" }, "DERAPPSECE": { "NETEXSTASV": 197000, "SPECASVALLACCAVAIL": 0 }, "DERAPPSECO": { "TOTASVOFFERED": 10000 }, "DERAPPSPSE": { "SPOUSEDETAILSREQUIREDIND": "N" } }, "Entity": [ { "DerivedCalcEntity": { "DERENTARRS": { "INDICATOR": "Z", "TOTALAMNT": 0 }, "DERENTCUST": { "EXISTINGCLIENTINDICATOR": "N", "EXISTINGCREDCLIENTINDICATOR": "N" }, "DERENTEXCS": { "INDICATOR": "X", "TOTALAMNT": 0 }, "DERENTINST": { "TOTALINSTALLMENTS": 0 }, "DERENTLMTS": { "TOTALLIMIT": 0 }, "DERENTSTOR": { "STRENGTHRELATIONSHIP": "N" } }, "INTENTAPRF": { "BBMLOANEXP": 0, "BBMLOANINST": 0, "BBOCE": 0, "BBOCEINST": 0, "RETAILMLOANEXP": 0, "RETAILMLOANINST": 0, "RETAILOCE": 0, "RETAILOCINST": 0 } }, { "DerivedCalcEntity": { "DERENTARRS": { "INDICATOR": "Z", "TOTALAMNT": 0 }, "DERENTCUST": { "EXISTINGCLIENTINDICATOR": "N", "EXISTINGCREDCLIENTINDICATOR": "N" }, "DERENTEXCS": { "INDICATOR": "X", "TOTALAMNT": 0 }, "DERENTINST": { "TOTALINSTALLMENTS": 0 }, "DERENTLMTS": { "TOTALLIMIT": 0 }, "DERENTSTOR": { "STRENGTHRELATIONSHIP": "N" } }, "INTENTAPRF": { "BBMLOANEXP": 0, "BBMLOANINST": 0, "BBOCE": 0, "BBOCEINST": 0, "RETAILMLOANEXP": 0, "RETAILMLOANINST": 0, "RETAILOCE": 0, "RETAILOCINST": 0 } }, { "DerivedCalcEntity": { "DERENTARRS": { "INDICATOR": "Z", "TOTALAMNT": 0 }, "DERENTCUST": { "EXISTINGCLIENTINDICATOR": "Y", "EXISTINGCREDCLIENTINDICATOR": "N" }, "DERENTEXCS": { "INDICATOR": "X", "TOTALAMNT": 0 }, "DERENTINST": { "TOTALINSTALLMENTS": 0 }, "DERENTLMTS": { "TOTALLIMIT": 0 }, "DERENTSTOR": { "STRENGTHRELATIONSHIP": "W" } }, "INTENTAPRF": { "BBMLOANEXP": 0, "BBMLOANINST": 0, "BBOCE": 0, "BBOCEINST": 0, "RETAILMLOANEXP": 0, "RETAILMLOANINST": 0, "RETAILOCE": 0, "RETAILOCINST": 0 } }, { "DerivedCalcEntity": { "DERENTARRS": { "INDICATOR": "S", "TOTALAMNT": 89231 }, "DERENTCUST": { "EXISTINGCLIENTINDICATOR": "Y", "EXISTINGCREDCLIENTINDICATOR": "Y" }, "DERENTEXCS": { "INDICATOR": "X", "TOTALAMNT": 0 }, "DERENTINST": { "TOTALINSTALLMENTS": 6795 }, "DERENTLMTS": { "TOTALLIMIT": 0 }, "DERENTSTOR": { "STRENGTHRELATIONSHIP": "W" } }, "INTENTAPRF": { "BBMLOANEXP": 0, "BBMLOANINST": 0, "BBOCE": 0, "BBOCEINST": 0, "RETAILMLOANEXP": 0, "RETAILMLOANINST": 0, "RETAILOCE": 0, "RETAILOCINST": 0 } }, { "APPENTIDTYPE": "05", "DerivedCalcEntity": { "DERENTARRS": { "INDICATOR": "N", "TOTALAMNT": 0 }, "DERENTCUST": { "EXISTINGCLIENTINDICATOR": "Y", "EXISTINGCREDCLIENTINDICATOR": "Y" }, "DERENTEXCS": { "INDICATOR": "X", "TOTALAMNT": 9613 }, "DERENTINST": { "TOTALINSTALLMENTS": 240 }, "DERENTLMTS": { "TOTALLIMIT": 0 }, "DERENTSTOR": { "STRENGTHRELATIONSHIP": "S" }, "RESENTBSTM": { "ADVIND": "P" } }, "INTENTAPRF": { "BBMLOANEXP": 0, "BBMLOANINST": 0, "BBOCE": 0, "BBOCEINST": 0, "RETAILMLOANEXP": 0, "RETAILMLOANINST": 0, "RETAILOCE": 0, "RETAILOCINST": 0 }, "INTENTBUR": { "COMMINPREGNUMBER": 197400242207 }, "INTENTCLIENTCODE1": "HAMBAKA001" } ], "StratRes1": { "RESAPPBSTM": { "BANKREPORTREQ": "N" }, "RESAPPCMNG": { "HOCMMAXOFFSETREDUC": 8.00, "HOCMMINPLUSMINRATE": 0.00, "PMMAXOFFSETREDUC": 1.00, "PMMINPLUSMINRATE": 0.00, "REMAXOFFSETREDUC": 0.00, "REMINPLUSMINRATE": 1.00, "SMMAXOFFSETREDUC": 0.50, "SMMINPLUSMINRATE": 0.50 }, "RESAPPEXCS": { "WRSTPRINCIPALO1VO2": "X", "WRSTPRINCIPALP1VP2": "X" }, "RESAPPGPAM": { "ABSADATARFRESHPERIOD": 7, "EXPILLUSTDAYSAFTERDECISION": 30, "EXPILLUSTDAYSNODECISION": 30, "EXPILLUSTDAYSREMOVE": 60, "FRAUDREFERRALPROCESS": 30, "GUINESSRATING": 56 }, "RESAPPSCRD": { "AGRICUTOFF": 0, "BCCCUTOFF": 156, "BGCUTOFF": 156, "BRLCUTOFF": 0, "CHEQCUTOFF": 156, "CPFCUTOFF": 0, "EPSCUTOFF": 0, "FCCUTOFF": 156, "GCCUTOFF": 156, "MOODYCUTOFF": 0, "ODCUTOFF": 156, "ORDCREDLIMIT": 2000000, "ORDCREDSCORINGMANDATE": 2500000, "TLCUTOFF": 133, "TRFCUTOFF": 156 } } } } }';
    @TestSetup
    static void makeData(){
        IntegrationTestDataFactory.insertIntegrationSettings(StringConstants.JITTERBIT2, new List<String>{PowerCurveUpdateApplication_IH_v1.INTEGRATION_SERVICE_NAME});
    }

    @isTest 
    static void testPositive() {
        // Set mock callout class
        Test.setMock(HttpCalloutMock.class, new Sys_Utilities_Integration_Mock_ApiRest(StringConstants.POSITIVE_STRING, POSITIVE_RESPONSE_BODY));

        Test.startTest();

        PowerCurveUpdateApplication_Resp_IB_v1 responseBean = callHandlerMethod();
        System.assertEquals(200, responseBean.statusCode);

        Test.stopTest();
    }
 
    private static PowerCurveUpdateApplication_Resp_IB_v1 callHandlerMethod() {
        PowerCurveUpdateApplication_Req_IB_v1 dummyBean = PowerCurveUpdateApplication_Req_IB_v1.createDummyRequest();
        System.debug('dummyBean: ' + dummyBean);
        PowerCurveUpdateApplication_Resp_IB_v1 responseBean = PowerCurveUpdateApplication_IH_v1.powerCurveUpdateApplication(dummyBean);
        return responseBean;
    }

}