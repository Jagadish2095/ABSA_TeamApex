/*
* Test Integration Handler for TransunionProcessRequest41 Service
* @author Prashant Jain
* @created 2020-05-20
*--------------------------------------
* @Updated By - Pitso Sekhu
* @Updated Date- 2021-03-18
* @Update Notes - Changes to EnquirerContactPhoneNo & EnquirerContactName from Hard coded value to Custom Label
*--------------------------------------
*/

@isTest
public class TransunionProcessRequest41_IH_v1_Test {

    public static final String POSITIVE_RESPONSE_BODY = '{"Envelope": {"Body": {"ProcessRequestTrans41Response": {"ProcessRequestTrans41Result": {"ResponseStatus": "Success","ProcessingStartDate": "2020-05-20T17:05:42.8270732+02:00","ProcessingTimeSecs": "0.3650208","UniqueRefGuid": "2e840d53-040c-416d-9881-c10c687e1573","AddressNA07": {"AddressNA07": [{}]},"AddressVerificationNR01": {},"AddressVerificationNR02": {},"AffordabilityAF01": {},"AffordStandardBatchCharsXB01": {},"AggregateAG01": {"ConsumerNo": "005645387","Aggregates": {"Aggregate": [{"Name": "EQ002","Value": "+000000011.0"}, {"Name": "EQ003","Value": "+000000000.0"}, {"Name": "EQ008","Value": "+000000009.0"}, {"Name": "EQ009"}, {"Name": "EQ011","Value": "+000000011.0"}, {"Name": "EQ012"}, {"Name": "EQ014","Value": "+000000011.0"}, {"Name": "EQ017","Value": "+000000011.0"}, {"Name": "EQ018"}, {"Name": "EQ032","Value": "+020200520.0"}, {"Name": "EQ033"}, {"Name": "EQ045"}, {"Name": "DF001","Value": "+000000000.0"}, {"Name": "DF002","Value": "+000000000.0"}, {"Name": "DF003","Value": "+000000000.0"}, {"Name": "DF022","Value": "+000000000.0"}, {"Name": "DF025","Value": "+000000000.0"}, {"Name": "JD001","Value": "+000000000.0"}, {"Name": "JD002","Value": "+000000000.0"}, {"Name": "JD003","Value": "+000000000.0"}, {"Name": "JD021","Value": "+000000000.0"}, {"Name": "JD023","Value": "+000000000.0"}, {"Name": "JD024","Value": "+000000000.0"}, {"Name": "JD025","Value": "+000000000.0"}, {"Name": "PP039"}, {"Name": "PP231"}]}},"AggregateAG02": {},"AggregateNX05": {},"AggregateNX09": {},"AggregateNX33": {"TotalJudgments": "0","TotalNoticesEver": "0","EnquiriesEver": "0","TotalAdverseEver": "0"  },"AlertDetailC4": {},"BCCBC01": {},"BCCBC03": {},"BCCBC04": {},"BCCB701": {},"BCCC1": {},"BCCC2": {},"CCASummaryMX01": {},"CCASummaryMX50": {},"ConsEnqTransInfo0102": {"DefiniteMatchCount": "1","PossibleMatchCount": "00","MatchedConsumerNo": "005645387"},"ConsumerCountersNC04": {},"ConsumerCountersNC50": {"ConsumerNo": "005645387","OwnEnquiries1YrBack": "011","OwnEnquiries2YrsBack": "000","OwnEnquiriesMoreThen2YrsBack": "000","OtherEnquiries1YrBack": "000","OtherEnquiries2YrsBack": "000","OtherEnquiriesMoreThen2YrsBack": "000","Judgements1YrBack": "000","Judgements2YrsBack": "000","JudgementsMoreThen2YrsBack": "000","Notices1YrBack": "000","Notices2YrsBack": "000","NoticesMoreThen2YrsBack": "000","Defaults1YrBack": "000","Defaults2YrsBack": "000","DefaultsMoreThen2YrsBack": "000","PaymentProfiles1YrBack": "000","PaymentProfiles2YrsBack": "000","PaymentProfilesMoreThen2YrsBack": "000","TraceAlerts1YrBack": "000","TraceAlerts2YrsBack": "000","TraceAlertsMoreThen2YrsBack": "000"},"ConsumerInfoNO04": {"RecordSeq": "01","Part": "001","PartSeq": "01","ConsumerNo": "005645387","Surname": "NAIDOO","Forename1": "ARMUGAM","Title": "MR","Gender": "M","NameInfoDate": "20151120","DateOfBirth": "19541112","IdentityNo1": "5411129249086","Dependants": "00","DeceasedDate": "00000000"},"ConsumerInfoNO05": {},"ConsumerTelephoneHistoryNW01": {},"CreditVisionVV01": {},"CreditVisionScoreCO01": {},"CreditVisionVX01": {},"DebtCounsellingDC01": {},"DisputeIndicatorDI01": {},"EchoData0001": {"SubscriberCode": "90787","ClientReference": "GN201910061","BatchNumber": "8114"},"EmpiricaEM04": {"ConsumerNo": "005645387","EmpiricaScore": "00005","ExpansionScore": "X","ExpansionScoreDescription": "Expansion Score"},"EmpiricaEM05": {},"EmpiricaEM07": {},"EnquiriesNE50": {"EnquiryNE50": [{"ConsumerNo": "005645387","DateOfEnquiry": "20200520","Subscriber": "Absa Merchant Ser","Contact": "ABSA 011146163","EnquiryTypeCode": "45","EnquiryTypeDescription": "OTHER","OwnAccount": "Y"}, {"ConsumerNo": "005645387","DateOfEnquiry": "20200519","Subscriber": "Absa Merchant Ser","Contact": "ABSA 011146163","EnquiryTypeCode": "45","EnquiryTypeDescription": "OTHER","OwnAccount": "Y"}, {"ConsumerNo": "005645387","DateOfEnquiry": "20200518","Subscriber": "Absa Merchant Ser","Contact": "ABSA 011146163","EnquiryTypeCode": "45","EnquiryTypeDescription": "OTHER","OwnAccount": "Y"}, {"ConsumerNo": "005645387","DateOfEnquiry": "20200506","Subscriber": "Absa Merchant Ser","Contact": "ABSA 011146163","EnquiryTypeCode": "45","EnquiryTypeDescription": "OTHER","OwnAccount": "Y"}, {"ConsumerNo": "005645387","DateOfEnquiry": "20200504","Subscriber": "Absa Merchant Ser","Contact": "ABSA 011146163","EnquiryTypeCode": "45","EnquiryTypeDescription": "OTHER","OwnAccount": "Y"}, {"ConsumerNo": "005645387","DateOfEnquiry": "20200502","Subscriber": "Absa Merchant Ser","Contact": "ABSA 011146163","EnquiryTypeCode": "45","EnquiryTypeDescription": "OTHER","OwnAccount": "Y"}, {"ConsumerNo": "005645387","DateOfEnquiry": "20200501","Subscriber": "Absa Merchant Ser","Contact": "ABSA 011146163","EnquiryTypeCode": "45","EnquiryTypeDescription": "OTHER","OwnAccount": "Y"}, {"ConsumerNo": "005645387","DateOfEnquiry": "20200430","Subscriber": "Absa Merchant Ser","Contact": "ABSA 011146163","EnquiryTypeCode": "45","EnquiryTypeDescription": "OTHER","OwnAccount": "Y"}, {"ConsumerNo": "005645387","DateOfEnquiry": "20200428","Subscriber": "Absa Merchant Ser","Contact": "ABSA 011146163","EnquiryTypeCode": "45","EnquiryTypeDescription": "OTHER","OwnAccount": "Y"}, {"ConsumerNo": "005645387","DateOfEnquiry": "20200415","Subscriber": "Absa Merchant Ser","Contact": "ABSA 011146163","EnquiryTypeCode": "45","EnquiryTypeDescription": "OTHER","OwnAccount": "Y"}, {"ConsumerNo": "005645387","DateOfEnquiry": "20200409","Subscriber": "Absa Merchant Ser","Contact": "ABSA 011146163","EnquiryTypeCode": "45","EnquiryTypeDescription": "OTHER","OwnAccount": "Y"}]},"FSMS201": {},"FraudScoreFS01": {},"FraudScoreFS01Part2": {},"HawkNH05": {},"IdvNI01": {"IDVerifiedCode": "V2","IDVerifiedDesc": "ID never Issued"},"IdvNI02": {},"IdvNI03": {},"IncomeEstimatorT101": {},"IncomeEstimatorT102": {},"IncomeEstimatorI401": {},"IVSBV01": {},"LapseL401": {},"LinkagesLK": {},"NLRConfirmationMR01": {},"NLRConfirmationMZ01": {},"NLRSummaryMY01": {},"NLRSummaryMY50": {},"EmployerInformation": {"EmploymentClientDetails": {}},"ScoreCardAC01": {},"ScoreCardBX01": {},"ScoreCardBX03": {},"StandardBatchCharsB101": {},"StandardBatchCharsFA01": {},"StandardBatchCharsFA02": {},"StandardBatchCharsFA03": {},"StandardBatchCharsSB04": {},"StandardBatchCharsSB07": {},"StandardBatchCharsSB13": {},"StandardBatchCharsSB18": {},"StandardBatchCharsSB19": {},"StandardBatchCharsSB25": {},"StandardBatchCharsSB27": {},"StandardBatchCharsSB30": {},"StandardBatchCharsSB33": {},"StandardBatchCharsSB37": {},"StandardBatchCharsSB40": {},"StandardBatchCharsSB99": {},"TraceAlertTL": {},"TicketSuccessConfirmationFR": {},"UniqueITCRef": {},"ClaimantHeaderCH": {},"ClaimantHeaderHC": {},"StrikeDateOutput": {},"LapseOutputV3": {}}}}}}';

    @TestSetup
    static void makeData(){
        IntegrationTestDataFactory.insertIntegrationSettings(StringConstants.JITTERBIT2, new List<String>{TransunionProcessRequest41_IH_v1.INTEGRATION_SERVICE_NAME});
    }

    @isTest static void testPositive() {
        // Set mock callout class
        Test.setMock(HttpCalloutMock.class, new Sys_Utilities_Integration_Mock_ApiRest(StringConstants.POSITIVE_STRING, POSITIVE_RESPONSE_BODY));

        Test.startTest();

        TransunionProcessRequest41_Resp_IB_v1 responseBean = callHandlerMethod();
        System.assertEquals(200, responseBean.statusCode);

        Test.stopTest();
    }

    private static TransunionProcessRequest41_Resp_IB_v1 callHandlerMethod() {
        TransunionProcessRequest41_Req_IB_v1 dummyBean = TransunionProcessRequest41_Req_IB_v1.createDummyRequest();
        TransunionProcessRequest41_Resp_IB_v1 responseBean = TransunionProcessRequest41_IH_v1.TransunionProcessRequest41(dummyBean);
        return responseBean;
    }
}