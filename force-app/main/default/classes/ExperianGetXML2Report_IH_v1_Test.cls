/*
* Test Integration Handler for ExperianGetXML2Report Service
* @author Prashant Jain
* @created 2020-05-22
*/

@isTest
public class ExperianGetXML2Report_IH_v1_Test {

    public static final String POSITIVE_RESPONSE_BODY = '{"Envelope":{"Body":{"GetXML2ReportResponse":{"GetXML2ReportResult":{"Session":{"User_ID":"MERCHTST","FullName":"MERCHTST","GroupName":"18455","Subscriber_ID":"18455","Group_ID":"18455","RequestType":"XML2","Environment":"TEST","Version":"1.0.0"},"InputData":{"First_Name_1":"CHANEL","Surname":"OOSTHUIZEN","National_ID":"8911270127087","RSA_ID":"YES","Birthday":"19891127"},"SubscriberInfo":{"BusinessType":"0"},"ReturnData":{"Match":"1","Name":"ZAKIYYAH EBRAHIM","Title":"MISS","Surname":"EBRAHIM","FirstName1":"ZAKIYYAH","ID":"8911270127087","Birthday":"19891127","Address":[{"Relation":"Primary Address","ReportDate":"20110207","Address_Line1":"254 FLAMING STREET","Address_Line2":"LENASIA EXT 2","ZipCode":"1827"}],"ReferenceNo":"183612481","Date":"2020-05-22","Time":"17:21","ExecTime":"0.37","SessionID":"5ZHKIRY604M"},"Detect":{"Flag":["Inactive"],"IDverification":{"IDverified":"No","SurnameVerified":"No","InitialsVerified":"No","ExperianIDnumber":"-787012113","ExperianSurname":"EBRAHIM","ExperianInitials":"ZAKIYYAH"},"DisputeIndicator":"N"},"ScoreBlock":{"Delphi":[{"Score":"3","Scorecard_Identifier":"33","ReasonCode":"33083305330933013302","ScoreName":"Risk Rating","RequestID":"6"}, {"Score":"587","Scorecard_Identifier":"73","ReasonCode":"73057306731173017307","ScoreName":"Delphi New Business G4 Banking","RequestID":"9"}]},"Enquiry":{"CPA":{"Own":[{"EnquiryDate":"20200522","SubscriberName":"MERCHTST","Subscriber_Operator":"MERCHTST"}, {"EnquiryDate":"20200522","SubscriberName":"MERCHTST","Subscriber_Operator":"MERCHTST"}]}},"Accounts":{"CPA":{"Other":[{"Subscriber":"DIRECT AXIS","Subscriber_Code":"210195","AccountNo":"DAJ 85231416565","AccountType":{"_code":"P ","__text":"Personal cash loan"},"OpenDate":"20150410","OpenBalance":"13000","CreditLimit":"13000","CurrentBalance":"13748","BalanceDate":"20171231","LastPayment":"999999999","LastPaymentDate":"20160126","Status":{"_code":" ","__text":"Open or current"},"StatusDate":"00000000","Installment":"515","PaymentStatus":"9","OverdueAmount":"13748","Ownership_Type_Code":"0","Ownership_Type_Description":"Other","Payment_Type_Code":"0","Payment_Type_Description":"Other","Deferred_Payment_Date":"20150526","Repayment_Frequency_Code":"3","Repayment_Frequency_Desc":"Monthly","Account_Sold_Third_Party_Indicator":"1","Third_Party_Name":"SHACKLETON CREDIT MANAGEMENT (PTY) LTD","No_of_Participants_Joint_Loan":"0","EndUseCode":"C","RepaymentPeriod":"60","Worst_Payment_History":"9","History_of_most_recent_12_months":"????????????","History_of_most_recent_24_months":"????????????????????????","PaymentCycle":{"Payment":[{"StatusDate":"20200501","Months":"??","Status":{"_code":"??","__text":"No data"},"OpenBalance":"0","CurrentBalance":"0","OverdueAmount":"0","Installment":"0"}, {"StatusDate":"20200401","Months":"??","Status":{"_code":"??","__text":"No data"},"OpenBalance":"0","CurrentBalance":"0","OverdueAmount":"0","Installment":"0"}]}}]}},"Addresses":{"Address":[{"Relation":"Primary Address","ReportDate":"20110207","Address_Line1":"254 FLAMING STREET","Address_Line2":"LENASIA EXT 2","ZipCode":"1827"}, {"Relation":"Primary Address","ReportDate":"20090531","Address_Line1":"FLATROOM NO 254","Address_Line2":"FLAMINGO","CityArea":"LENASIA EXT 2","ZipCode":"1827"}]},"Telephones":{"Telephone":[{"PhonePrefix":"72","PhoneNumber":"5078181","LastReportedDate":"20100707","PhoneType":"Cell"}, {"PhonePrefix":"11","PhoneNumber":"8545939","LastReportedDate":"20100630","PhoneType":"Work"}]},"Employers":{"Employer":[{"Name":"UEMP","Occupation":"CASHIER 00","Employer_Address":"CASHIER","Date_Supplied":"0","Income_Frequency":"M"}, {"Name":"DB CASH N CARRY","Occupation":"STUDENT 00","Employer_Address":"STUDENT","Date_Supplied":"0","Income_Frequency":"M"}]},"Summary":{"NLR_CumulativeArrears":"0","TotalCreditLimitOpenCreditCardAccounts":"0","NLR_Past_12_Months":{"Positive_loans":"0"},"NLR_Past_24_Months":{"Positive_loans":"0"},"NLR_Past_36_Months":{"Positive_loans":"0"},"CPA_CumulativeArrears":"21039","CPA_Past_12_Months":{"Positive_loans":"0"},"CPA_Past_24_Months":{"Positive_loans":"0","Highest_months_in_arrears":"0"},"CPA_Past_36_Months":{"Positive_loans":"2","Highest_months_in_arrears":"9"},"Judgements":{"Total_Number_of_Judgments_Ever":"0","Number_of_Judgments_in_the_Last_30_days":"0","Number_of_Judgments_in_the_Last_90_days":"0","Number_of_Judgments_in_the_Last_180_days":"0","Number_of_Judgments_in_the_Last_year":"0","Number_of_Judgments_in_the_Last_2_years":"0","Number_of_Judgments_in_the_Last_3_years":"0","Number_of_Judgments_in_the_Last_4_years":"0","Number_of_Judgments_in_the_Last_5_years":"0","Total_Judgment_Value":"0","Highest_Judgment_Value":"0","Value_of_Most_Recent_Judgment":"0","Total_Number_of_Medical_Judgments":"0","Total_Value_of_Medical_Judgments":"0","Total_Number_of_Other_Judgments":"0","Total_Value_of_Other_Judgments":"0","Number_of_Judgments_in_the_Previous_6_Months":"0","Number_of_Judgments_in_the_Last_7_to_18_Months":"0","Number_of_Judgments_in_the_Last_19_to_36_Months":"0","Number_of_Judgments_Older_than_37_Months":"0"},"Adverses":{"CPA":{"Total_Number_of_Adverses_Ever":"0","Number_of_Adverses_in_the_Last_30_days":"0","Number_of_Adverses_in_the_Last_90_days":"0","Number_of_Adverses_in_the_Last_180_days":"0","Number_of_Adverses_in_the_Last_year":"0","Number_of_Adverses_in_the_Last_2_years":"0","Number_of_Adverses_in_the_Last_3_years":"0","Number_of_Adverses_in_the_Last_4_years":"0","Number_of_Adverses_in_the_Last_5_years":"0","Total_Value_of_all_Adverses":"0","Highest_Adverse_Value":"0","Value_of_Most_Recent_Adverse":"0","Number_of_Adverses_in_the_Previous_6_Months":"0","Number_of_Adverses_in_the_Last_19_to_36_Months":"0"}},"Trace":{"Total_Number_of_Traces_Ever":"0","Number_of_Traces_in_the_Last_30_days":"0","Number_of_Traces_in_the_Last_60_days":"0","Number_of_Traces_in_the_Last_90_days":"0","Number_of_Traces_in_the_Last_180_days":"0","Number_of_Traces_in_the_Last_year":"0","Number_of_Traces_in_the_Last_2_years":"0","Number_of_Traces_in_the_Last_3_years":"0","Number_of_Traces_in_the_Last_4_years":"0","Number_of_Traces_in_the_Last_5_years":"0"},"Notices":{"Total_Number_of_Notices_Ever":"0","Number_of_Notices_in_the_Last_30_days":"0","Number_of_Notices_in_the_Last_90_days":"0","Number_of_Notices_in_the_Last_180_days":"0","Number_of_Notices_in_the_Last_year":"0","Number_of_Notices_in_the_Last_2_years":"0","Number_of_Notices_in_the_Last_3_years":"0","Number_of_Notices_in_the_Last_4_years":"0","Number_of_Notices_in_the_Last_5_years":"0","Number_of_Notices_in_the_Previous_6_Months":"0","Number_of_Notices_in_the_Last_7_to_18_Months":"0","Number_of_Notices_in_the_Last_19_to_36_Months":"0","Number_of_Notices_Older_than_37_Months":"0"},"Collections":{"Total_Number_of_Collections_Ever":"0","Number_of_Collections_in_the_Last_30_days":"0","Number_of_Collections_in_the_Last_90_days":"0","Number_of_Collections_in_the_Last_180_days":"0","Number_of_Collections_in_the_Last_year":"0","Number_of_Collections_in_the_Last_2_years":"0","Number_of_Collections_in_the_Last_3_years":"0","Number_of_Collections_in_the_Last_4_years":"0","Number_of_Collections_in_the_Last_5_years":"0","Total_Collection_Capital_Value":"0","Total_Collections_Amount_Collected_Ever":"0","Total_amount_Collected_on_Collections_opened_in_the_Last_3_Months":"0","Total_amount_Collected_on_Collections_opened_in_the_Last_6_Months":"0","Total_amount_Collected_on_Collections_opened_in_the_Last_12_Months":"0","Number_of_Payments_in_the_Last_3_Months":"0","Number_of_Payments_in_the_Last_6_Months":"0","Number_of_Payments_in_the_Last_12_Months":"0","Highest_Collection_Value":"0","Value_of_Most_Recent_Collection":"0"},"Negatives":{"Total_Number_of_Negatives_Ever":"0","Number_of_Negatives_in_the_Last_30_days":"0","Number_of_Negatives_in_the_Last_90_days":"0","Number_of_Negatives_in_the_Last_180_days":"0","Number_of_Negatives_in_the_Last_year":"0","Number_of_Negatives_in_the_Last_2_years":"0","Number_of_Negatives_in_the_Last_3_years":"0","Number_of_Negatives_in_the_Last_4_years":"0","Number_of_Negatives_in_the_Last_5_years":"0","Highest_Negative_Value":"0","Months_Since_Highest_Negative":"0","Value_of_Most_Recent_Negative":"0"},"All_Negatives":{"All_Total_Number_of_Negatives_Ever":"0","All_Number_of_Negatives_in_the_Last_30_days":"0","All_Number_of_Negatives_in_the_Last_90_days":"0","All_Number_of_Negatives_in_the_Last_180_days":"0","All_Number_of_Negatives_in_the_Last_year":"0","All_Number_of_Negatives_in_the_Last_2_years":"0","All_Number_of_Negatives_in_the_Last_3_years":"0","All_Number_of_Negatives_in_the_Last_4_years":"0","All_Number_of_Negatives_in_the_Last_5_years":"0","All_Highest_Negative_Value":"0","All_Months_Since_Highest_Negative":"0","All_Value_of_Most_Recent_Negative":"0"},"Enquiries":{"CPA":{"Own":[{"Total_Number_of_Own_Enquiries_Ever":"25","Number_of_Own_Enquiries_in_the_Last_7_days":"25","Number_of_Own_Enquiries_in_the_Last_28_days":"25","Number_of_Own_Enquiries_in_the_Last_30_days":"25","Number_of_Own_Enquiries_in_the_Last_90_days":"25","Number_of_Own_Enquiries_in_the_Last_180_days":"25","Number_of_Own_Enquiries_in_the_Last_year":"25","Number_of_Own_Enquiries_in_the_Last_2_years":"25","Number_of_Own_Enquiries_in_the_Last_3_years":"25","Number_of_Own_Enquiries_in_the_Last_4_years":"25","Number_of_Own_Enquiries_in_the_Last_5_years":"25","Months_Since_Recent_Own_Enquiry":"0","Months_Since_Oldest_Own_Enquiry":"0","Days_Since_Recent_Own_Enquiry":"0"}]}},"Payment_Profiles":{"CPA":{"All":{"Number_of_All_PPs_Ever":"3","Number_of_All_Revolving_PPs_Ever":"1","Number_of_All_Fixed_Installment_PPs_Ever":"0","Number_of_All_PPs_in_the_Last_30_Days":"0","Number_of_All_PPs_in_the_Last_90_Days":"0","Number_of_Currently_Open_All_PPs":"2","Total_Outstanding_CPA_Balance_All":"0","Number_of_Closed_All_PPs":"1","Total_Balance_of_All_Open_Account_PPs":"0"}}}}}}}}}';

    @TestSetup
    static void makeData(){
        IntegrationTestDataFactory.insertIntegrationSettings(StringConstants.JITTERBIT2, new List<String>{ExperianGetXML2Report_IH_v1.INTEGRATION_SERVICE_NAME});
    }

    @isTest static void testPositive() {
        // Set mock callout class
        Test.setMock(HttpCalloutMock.class, new Sys_Utilities_Integration_Mock_ApiRest(StringConstants.POSITIVE_STRING, POSITIVE_RESPONSE_BODY));

        Test.startTest();

        ExperianGetXML2Report_Resp_IB_v1 responseBean = callHandlerMethod();
        System.assertEquals(200, responseBean.statusCode);

        Test.stopTest();
    }

    private static ExperianGetXML2Report_Resp_IB_v1 callHandlerMethod() {
        ExperianGetXML2Report_Req_IB_v1 dummyBean = ExperianGetXML2Report_Req_IB_v1.createDummyRequest();
        ExperianGetXML2Report_Resp_IB_v1 responseBean = ExperianGetXML2Report_IH_v1.ExperianGetXML2Report(dummyBean.GetXML2Report.inputData.Consumer.Application.Surname, dummyBean.GetXML2Report.inputData.Consumer.Application.First_Name_1, dummyBean.GetXML2Report.inputData.Consumer.Application.National_ID, dummyBean.GetXML2Report.inputData.Consumer.Application.RSAid, dummyBean.GetXML2Report.inputData.Consumer.Application.Birthday);
        return responseBean;
    }
}