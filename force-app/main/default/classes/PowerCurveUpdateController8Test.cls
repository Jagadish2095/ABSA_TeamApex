/**
 * @description       : Test class for PowerCurveUpdateController8
 * @author            :  Almas.Aleem@absa.africa
 * @last modified on  : 2021-06-18
 * @last modified by  : englarmerdge.mongwe@absa.africa
 * Modifications Log
 * Ver   Date         Author                            Modification
 * 1.0   2021-06-18    Almas.Aleem@absa.africa   Initial Version
**/
@IsTest
public class PowerCurveUpdateController8Test {
    /**
    * @description method to setup test data
    * @author Almas.Aleem@absa.africa | 2021-06-18
    **/
    @testSetup
    static void createData() {
        Account mainAccount = new Account(Name = 'Test Main Account');
        insert mainAccount;

        Opportunity opp = new Opportunity (Name ='testopp', AccountId = mainAccount.Id, StageName = 'New', CloseDate = system.today());
        insert opp;

        Account account = new Account(Name = 'Test Account');
        insert account;

        Contact contact = new Contact(LastName = 'Test contact', AccountId = account.Id, Email = 'agents@support.co.za');
        insert contact;

        AccountContactRelation accConnRel = new AccountContactRelation();
        accConnRel.AccountId = mainAccount.Id;
        accConnRel.ContactId = contact.Id;
        insert accConnRel;

        Product2 prod = new Product2(Name = 'Cheque Product', Family = 'Cheque');
        insert prod;

        Id pricebookId = Test.getStandardPricebookId();
        PricebookEntry standardPrice = new PricebookEntry(Pricebook2Id = pricebookId, Product2Id = prod.Id, UnitPrice = 10000, IsActive = true);
        insert standardPrice;

        Pricebook2 customPB = new Pricebook2(Name = 'Standard Pricebook', isActive = true);
        insert customPB;

        PricebookEntry customPrice = new PricebookEntry(Pricebook2Id = customPB.Id, Product2Id = prod.Id, UnitPrice = 12000, IsActive = true);
        insert customPrice;

        OpportunityLineItem oppLineItem = new OpportunityLineItem();
        oppLineItem.OpportunityId = opp.id;
        oppLineItem.Product2Id = prod.id;
        oppLineItem.PricebookEntryId = customPrice.id;
        oppLineItem.Quantity = 1;
        oppLineItem.TotalPrice = 100;
        insert oppLineItem;

        Application_Product__c parentApplicationRecord = new Application_Product__c();
        parentApplicationRecord.Opportunity__c = opp.Id;
        parentApplicationRecord.Product_Name__c = 'Cheque';
        parentApplicationRecord.Product_Type__c = '11021';//API picklist value for CLASSIC BUSINESS ACCOUNT
        parentApplicationRecord.Product_State__c = 'New';
        parentApplicationRecord.Opportunity_Product_Id__c = '001';
        parentApplicationRecord.Product_Status__c = 'Accepted';
        parentApplicationRecord.Accept_TOB__c = true;
        parentApplicationRecord.Is_Sanctioning_Decision__c = true;
        insert parentApplicationRecord;

        Application_Product__c parentApplicationRecord1 = new Application_Product__c();
        parentApplicationRecord1.Opportunity__c = opp.Id;
        parentApplicationRecord1.Product_Name__c = 'Cheque';
        parentApplicationRecord1.Product_Type__c = '11021';//API picklist value for CLASSIC BUSINESS ACCOUNT
        parentApplicationRecord1.Account_Number__c = 1000157283;
        parentApplicationRecord1.Product_State__c = 'Existing';
        parentApplicationRecord1.Opportunity_Product_Id__c = '001';
        parentApplicationRecord1.Product_Status__c = 'Declined';
        parentApplicationRecord1.Accept_TOB__c = true;
        parentApplicationRecord1.Is_Sanctioning_Decision__c = true;
        insert parentApplicationRecord1;

        Application_Product__c parentApplicationRecord2 = new Application_Product__c();
        parentApplicationRecord2.Opportunity__c = opp.Id;
        parentApplicationRecord2.Product_Name__c = 'Cheque';
        parentApplicationRecord2.Product_Type__c = '11021';//API picklist value for CLASSIC BUSINESS ACCOUNT
        parentApplicationRecord2.Product_State__c = 'New';
        parentApplicationRecord2.Opportunity_Product_Id__c = '001';
        parentApplicationRecord2.Product_Status__c = 'Pending';
        parentApplicationRecord2.Accept_TOB__c = true;
        parentApplicationRecord2.Is_Sanctioning_Decision__c = true;
        insert parentApplicationRecord2;

        Application_Product__c childApplicationRecord = new Application_Product__c();
        childApplicationRecord.Opportunity__c = opp.Id;
        childApplicationRecord.Product_Name__c = 'Overdraft';
        childApplicationRecord.Product_Amount__c = 1000000.00;
        childApplicationRecord.Product_State__c = 'New';
        childApplicationRecord.Product_Status__c = 'Accepted';
        childApplicationRecord.Opportunity_Product_Id__c = '002';
        childApplicationRecord.Limit_Type__c='Reducing - Once Off Only';
        childApplicationRecord.Once_Off_Amount__c=20000;
        childApplicationRecord.Application_Product_Parent__c = parentApplicationRecord.Id;
        insert childApplicationRecord;

        Application__c testApplication = new Application__c();
        testApplication.Opportunity__c = opp.Id;
        testApplication.Preferred_Communication_Method__c='himanshu.nimje@absa.africa';
        testApplication.Preferred_SMS__c='065892600';
        testApplication.Preferred_Communication_Method__c='Email';
        testApplication.Fees_Waived__c = true;
        testApplication.Products_And_Services__c = 'NotifyMe';
        testApplication.Credit_App_Status_Change_Date__c=date.today();
        testApplication.Credit_App_Status_Change_Time__c=time.newInstance(1, 60, 60, 200);
        insert testApplication;

        List<Terms_Of_Business__c> tobs = new List<Terms_Of_Business__c>();
        Terms_Of_Business__c tob=new Terms_Of_Business__c();
        tob.Application_Product__c=parentApplicationRecord.Id;
        tob.Tob_Description__c='Overdraft Limit';
        tobs.add(tob);

        Terms_Of_Business__c tob1=new Terms_Of_Business__c();
        tob1.Application_Product__c=parentApplicationRecord.Id;
        tob1.Tob_Description__c='Regular Reduction Amount';
        tobs.add(tob1);

        Terms_Of_Business__c tob2=new Terms_Of_Business__c();
        tob2.Application_Product__c=parentApplicationRecord.Id;
        tob2.Tob_Description__c='Regular Reduction Frequency';
        tobs.add(tob2);

        Terms_Of_Business__c tob3=new Terms_Of_Business__c();
        tob3.Application_Product__c=parentApplicationRecord.Id;
        tob3.Tob_Description__c='Limit Review Period';
        tobs.add(tob3);

        Terms_Of_Business__c tob4=new Terms_Of_Business__c();
        tob4.Application_Product__c=parentApplicationRecord.Id;
        tob4.Tob_Description__c='Once-Off Reduction Amount';
        tobs.add(tob4);

        Terms_Of_Business__c tob5=new Terms_Of_Business__c();
        tob5.Application_Product__c=parentApplicationRecord.Id;
        tob5.Tob_Description__c='Monthly Service Fee';
        tobs.add(tob5);

        Terms_Of_Business__c tob6=new Terms_Of_Business__c();
        tob6.Application_Product__c=parentApplicationRecord.Id;
        tob6.Tob_Description__c='Overdraft Limit Type';
        tobs.add(tob6);

        Terms_Of_Business__c tob7=new Terms_Of_Business__c();
        tob7.Application_Product__c=parentApplicationRecord.Id;
        tob7.Tob_Description__c='Initiation Fee';
        tobs.add(tob7);

        Terms_Of_Business__c tob8=new Terms_Of_Business__c();
        tob8.Application_Product__c=parentApplicationRecord1.Id;
        tob8.Tob_Description__c='Overdraft Limit';
        tobs.add(tob8);
        insert tobs;
    }

    @isTest
    static void testPCO8() {
        Application_Product__c appProduct = [SELECT Id, Name FROM Application_Product__c WHERE Product_State__c = 'New' AND Product_Status__c = 'Accepted' LIMIT 1];
        string requestP='{"Request":{"ApplicationDV":{"RequestedProducts02":{"INTPRDNEWF":{},"DERPRDNEWF":null,"APPPRDSECO":{"SUPPORTINGSPECIFIC":"0","SPECIFIC":"0"},"APPPRDNEWF":{"UNIQUEPRODID":"' + appProduct.Name + '","SETTLEMENTSAMNT":"0","SECUREDBYMORTGAGEBOND":"N","REQTOTALAMNT":"240000","REQTERMOFLOAN":"0","REQREQEMPOWERMNTFUNDIND":"N","REQREQEMPOWERMNTFUND":"","REQREPAYMNTOPTION":"0","REQREDUCTIONFREQ":"","REQREDUCTIONAMNT":"","REQPURPOSEFACILITYORLOAN":"11","REQPRODUCT":"CHQ","REQPRODTYPE":"11016","REQPRODCOMBINATIONNUM":"0","REQPAYMNTMETHOD":"D","REQONCEOFFFREQAMNT":"","REQODLIMITTYPE":"","REQNUMSKIPPEDPAYMNTS":"0","REQLIMITTYPEIND":"","REQLIMIT":"240000","REQINSTALLMENTFREQ":"0","REQINITIATIONFEEPAYMNTMETHOD":"D","REQFACILITYTYPE":"1","REQCREDLIFEPREMIUM":"0","REQCAMPAIGNCODE":"","REQADDITIONALAMNT":"240000","NCAAPPLICABLE":"Y","JURISTICIND":"Y","INSTSETTLEMENTS":"0","ESPINSTRUCTION":"","CARDTYPE":"","APPLICATIONSTATUS":"P"}},"RequestedProducts01":{"INTPRDNEWF":{},"":{"FINALTOTALAMNT":"100000","FINALSERVICEFEE":"69","FINALREDUCTIONPERIOD":"0","FINALREDUCTIONFREQ":"1","FINALREDUCTIONAMNT":"5000","FINALONCEOFFREDUCTIONAMNT":"0","FINALODLIMITTYPE":"3","FINALINTRATEPRIMEPLUS":"2","FINALINITFEEAMOUNT":"0","FINALDECTIME":"080311","FINALDECISION":"A","FINALDECDATE":"2021-03-17"},"APPPRDSECO":{"SUPPORTINGSPECIFIC":"0","SPECIFIC":"0"},"APPPRDNEWF":{"UNIQUEPRODID":"APC-00112616","SETTLEMENTSAMNT":"0","SECUREDBYMORTGAGEBOND":"Y","REQTOTALAMNT":"120000","REQTERMOFLOAN":"0","REQREQEMPOWERMNTFUNDIND":"N","REQREQEMPOWERMNTFUND":"","REQREPAYMNTOPTION":"0","REQREDUCTIONFREQ":"","REQREDUCTIONAMNT":"","REQPURPOSEFACILITYORLOAN":"13","REQPRODUCT":"CHQ","REQPRODTYPE":"11021","REQPRODCOMBINATIONNUM":"0","REQPAYMNTMETHOD":"D","REQONCEOFFFREQAMNT":"","REQODLIMITTYPE":"","REQNUMSKIPPEDPAYMNTS":"0","REQLIMITTYPEIND":"","REQLIMIT":"120000","REQINSTALLMENTFREQ":"0","REQINITIATIONFEEPAYMNTMETHOD":"D","REQFACILITYTYPE":"1","REQCREDLIFEPREMIUM":"0","REQCAMPAIGNCODE":"","REQADDITIONALAMNT":"120000","NCAAPPLICABLE":"N","JURISTICIND":"Y","INSTSETTLEMENTS":"0","ESPINSTRUCTION":"","CARDTYPE":"","APPLICATIONSTATUS":"P"}},"INTAPPSICCODE":"61901","INTAPPOVERALLCONTROLBRANCH":"0","INTAPPEXISTINGFRANCHISORTYPE":"","INTAPPEXISTINGFRANCHISEFINANCING":"N","INTAPPENTERPRDEVFUNDEXISTING":"","INTAPPBUSINESSSUBSEGMENT":"","INTAPPBUSINESSSEGMENT":"","INTAPPBRANCHCODE":"8392","ExistingProducts01":{"INTPRDSECE":{"SPECASVLIMITED":"0","SPECASVFULL":"0"},"DERPRDEXST":null,"INTPRDEXST":{"SECUREDBYMORTGAGEBOND":"N","PRODUCTTYPE":"11019","PRODUCT":"CHQ","NCAMAXINITFEEAMNT":"0","ESPINSTRUCTION":"","CURRSUBPRODTYPE":"","CURRSETTLEMENTAMNT":"0","CURRREDUCTIONFREQ":"0","CURRREDUCTIONAMNT":"0","CURRONCEOFFREDUCTION":"0","CURRLIMIT":"0","CURRINTRATEPRIMEOFFSET":"0","CURRINSTALMNTFREQ":"0","CURRINSTALLMENT":"0","CURRINITFEEPREVDEBITED":"","CURREXISTEMPOWERMNTFUNDIND":"Y","CURREXISTEMPOWERMNTFUND":"999","CURRENFORCEDREDLIM":"N","CURRBALANCE":"-6109596","CARDTYPE":"","ACCOUNTNUMBER":"1000157283"},"APPPRDSECO":{"SUPPORTINGSPECIFIC":"0","SPECIFIC":"0"},"APPPRDEXST":{"REQTOTALAMNT":"900000","REQTERMOFLOAN":"0","REQSUBPRODTYPE":"","REQREQEMPOWERMNTFUNDIND":"Y","REQREQEMPOWERMNTFUND":"999","REQREPAYMNTOPTION":"0","REQREDUCTIONFREQ":"0","REQREDUCTIONAMNT":"0","REQPRODTYPE":"11019","REQPRODCOMBINATIONNUM":"0","REQPAYMNTMETHOD":"","REQONCEOFFFREQAMNT":"0","REQODLIMITTYPE":"2","REQNUMSKIPPEDPAYMNTS":"0","REQLIMITTYPEIND":"0","REQINSTALLMENTFREQ":"0","REQINITIATIONFEEPAYMNTMETHOD":"D","REQFACILITYTYPE":"0","REQCREDLIFEPREMIUM":"0","REQCAMPAIGNCODE":"","REQADDITIONALAMNT":"0","INITIATIONFEEPAYMNTMETHOD":"","APPLICATIONSTATUS":"P"}},"Entity06":{"INTENTUNDERJUDICIALMNGMNT":"","INTENTUNDERDEBTCOUNSELLING":"","INTENTTRID":{"TOTSAVRETPAYMNTSL6M":"","TOTCHEQRETPAYMNTSL6M":"","NUMRDEVENTSSAVL6M":"0","NUMRDEVENTSSAVL3M":"0","NUMRDEVENTSCHEQL6M":"0","NUMRDEVENTSCHEQL3M":"0","NUMMNTHSEXCESSBALL6M":"0","NUMDEBITSL6M":"0","NUMDAYSDEBITINL6M":"0","NUMDAYSCREDITINL6M":"0","MNTHSOLDESTSAVACCREL":"0","MNTHSOLDESTCUSTREL":"0","MNTHSOLDESTCHACCREL":"0","MNTHSOLDESTACCREL":"0","MAXOCSCORINGMANDATE":"0","MAXCONSECDAYSINEXCESS":"0","EXPECTEDCREDTURNOVCUST":"0","EXPECTEDCREDTURNOVCHEQ":"0","EXCLUSIONTYPE":"","EXCLUSIONREASON":"","EXCLUSIONCREDITFACILITY":"","BEHAVSCOREMORTG":"0","BEHAVSCORELOANS":"0","BEHAVSCORECUSTALIGN":"0","BEHAVSCORECHEQ":"0","BEHAVSCORECC":"0","BEHAVSCOREAVAF":"0","AVGCTOL6ML12M":"0.00","AVGCTOL3ML6M":"0.00","AOL":"0","AMR":"0","AMMR":"0","AMLR":"0","ACCL":"0","ABRA":"0"},"INTENTRDET":{},"INTENTNUMPARTICIPANTS6":"","INTENTNUMPARTICIPANTS5":"","INTENTNUMPARTICIPANTS4":"","INTENTNUMPARTICIPANTS3":"","INTENTNUMPARTICIPANTS2":"","INTENTNUMPARTICIPANTS1":"","INTENTNONRESIDENT":"N","INTENTMARITALSTATUS":"","INTENTMARITALCONTRACT":"","INTENTLMTS":{},"INTENTINST":{},"INTENTINSOLVENT":"N","INTENTHIGHLEVELLIMITINDICATOR":"N","INTENTFINANCIALCRIMEHOLD":"","INTENTEXPO":{},"INTENTEXCS":{},"INTENTCTBALANCETERMDEPOSITS":"0","INTENTCTBALANCESAVINGS":"0","INTENTCTBALANCENOTICEDEPOSITS":"0","INTENTCTBALANCECUSTINVESTMENTS":"0","INTENTCTBALANCECHEQS":"0","INTENTCTBALANCECASHCOVER":"0","INTENTCMTM":{},"INTENTCLIENTTYPE":"","INTENTCLIENTCODE6":"","INTENTCLIENTCODE5":"","INTENTCLIENTCODE4":"","INTENTCLIENTCODE3":"","INTENTCLIENTCODE2":"","INTENTCLIENTCODE1":"","INTENTCDUCTMAINPYTURNOVER":"0","INTENTBURCOMMNOPOSSIBLEMATCH":"","INTENTBUR":{"COMMINPVATNUMBER":"","COMMINPTRADINGNAME":"","COMMINPREGNUMBER":"","COMMINPKIMNUMBER":"","COMMINPBUSNAME":""},"INTENTARRS":{},"APPENTSHAREHOLDINGPERC":"0","APPENTMNTHSSHAREHOLDINGPERC":"0","APPENTINTENTIONTOINSOLVENCY":"N","APPENTIDTYPE":"","APPENTEXPO":{},"APPENTBUR":{"CONSINPWRKPHNCDE":"","CONSINPWRKPHN":"","CONSINPSNAME":"","CONSINPRESSUBURB":"","CONSINPRESPOSTCDE":"","CONSINPRESCTY":"","CONSINPRESADDR2":"","CONSINPRESADDR1":"","CONSINPPSTSUBURB":"","CONSINPPSTPOSTCDE":"","CONSINPPSTCTY":"","CONSINPPSTADDR1":"","CONSINPOCC":"","CONSINPHMPHNCDE":"","CONSINPHMPHN":"","CONSINPFNAME2":"","CONSINPFNAME1":"","CONSINPEMP":"","CONSINPDOB":""},"APPENTAPRF":{},"APPENTAGEOLDESTRELATIONSHIP":"0","APPENTAGE":"0000"},"Entity05":{"INTENTUNDERJUDICIALMNGMNT":"","INTENTUNDERDEBTCOUNSELLING":"","INTENTTRID":{"TOTSAVRETPAYMNTSL6M":"","TOTCHEQRETPAYMNTSL6M":"","NUMRDEVENTSSAVL6M":"0","NUMRDEVENTSSAVL3M":"0","NUMRDEVENTSCHEQL6M":"0","NUMRDEVENTSCHEQL3M":"0","NUMMNTHSEXCESSBALL6M":"0","NUMDEBITSL6M":"0","NUMDAYSDEBITINL6M":"0","NUMDAYSCREDITINL6M":"0","MNTHSOLDESTSAVACCREL":"0","MNTHSOLDESTCUSTREL":"0","MNTHSOLDESTCHACCREL":"0","MNTHSOLDESTACCREL":"0","MAXOCSCORINGMANDATE":"0","MAXCONSECDAYSINEXCESS":"0","EXPECTEDCREDTURNOVCUST":"0","EXPECTEDCREDTURNOVCHEQ":"0","EXCLUSIONTYPE":"","EXCLUSIONREASON":"","EXCLUSIONCREDITFACILITY":"","BEHAVSCOREMORTG":"0","BEHAVSCORELOANS":"0","BEHAVSCORECUSTALIGN":"0","BEHAVSCORECHEQ":"0","BEHAVSCORECC":"0","BEHAVSCOREAVAF":"0","AVGCTOL6ML12M":"0.00","AVGCTOL3ML6M":"0.00","AOL":"0","AMR":"0","AMMR":"0","AMLR":"0","ACCL":"0","ABRA":"0"},"INTENTRDET":{},"INTENTNUMPARTICIPANTS6":"","INTENTNUMPARTICIPANTS5":"","INTENTNUMPARTICIPANTS4":"","INTENTNUMPARTICIPANTS3":"","INTENTNUMPARTICIPANTS2":"","INTENTNUMPARTICIPANTS1":"","INTENTNONRESIDENT":"N","INTENTMARITALSTATUS":"","INTENTMARITALCONTRACT":"","INTENTLMTS":{},"INTENTINST":{},"INTENTINSOLVENT":"N","INTENTHIGHLEVELLIMITINDICATOR":"N","INTENTFINANCIALCRIMEHOLD":"","INTENTEXPO":{},"INTENTEXCS":{},"INTENTCTBALANCETERMDEPOSITS":"0","INTENTCTBALANCESAVINGS":"0","INTENTCTBALANCENOTICEDEPOSITS":"0","INTENTCTBALANCECUSTINVESTMENTS":"0","INTENTCTBALANCECHEQS":"0","INTENTCTBALANCECASHCOVER":"0","INTENTCMTM":{},"INTENTCLIENTTYPE":"","INTENTCLIENTCODE6":"","INTENTCLIENTCODE5":"","INTENTCLIENTCODE4":"","INTENTCLIENTCODE3":"","INTENTCLIENTCODE2":"","INTENTCLIENTCODE1":"","INTENTCDUCTMAINPYTURNOVER":"0","INTENTBURCOMMNOPOSSIBLEMATCH":"","INTENTBUR":{"COMMINPVATNUMBER":"","COMMINPTRADINGNAME":"","COMMINPREGNUMBER":"","COMMINPKIMNUMBER":"","COMMINPBUSNAME":""},"INTENTARRS":{},"APPENTSHAREHOLDINGPERC":"0","APPENTMNTHSSHAREHOLDINGPERC":"0","APPENTINTENTIONTOINSOLVENCY":"N","APPENTIDTYPE":"","APPENTEXPO":{},"APPENTBUR":{"CONSINPWRKPHNCDE":"","CONSINPWRKPHN":"","CONSINPSNAME":"","CONSINPRESSUBURB":"","CONSINPRESPOSTCDE":"","CONSINPRESCTY":"","CONSINPRESADDR2":"","CONSINPRESADDR1":"","CONSINPPSTSUBURB":"","CONSINPPSTPOSTCDE":"","CONSINPPSTCTY":"","CONSINPPSTADDR1":"","CONSINPOCC":"","CONSINPHMPHNCDE":"","CONSINPHMPHN":"","CONSINPFNAME2":"","CONSINPFNAME1":"","CONSINPEMP":"","CONSINPDOB":""},"APPENTAPRF":{},"APPENTAGEOLDESTRELATIONSHIP":"0","APPENTAGE":"0000"},"Entity04":{"INTENTUNDERJUDICIALMNGMNT":"","INTENTUNDERDEBTCOUNSELLING":"","INTENTTRID":{"TOTSAVRETPAYMNTSL6M":"","TOTCHEQRETPAYMNTSL6M":"","NUMRDEVENTSSAVL6M":"0","NUMRDEVENTSSAVL3M":"0","NUMRDEVENTSCHEQL6M":"0","NUMRDEVENTSCHEQL3M":"0","NUMMNTHSEXCESSBALL6M":"0","NUMDEBITSL6M":"0","NUMDAYSDEBITINL6M":"0","NUMDAYSCREDITINL6M":"0","MNTHSOLDESTSAVACCREL":"0","MNTHSOLDESTCUSTREL":"0","MNTHSOLDESTCHACCREL":"0","MNTHSOLDESTACCREL":"0","MAXOCSCORINGMANDATE":"0","MAXCONSECDAYSINEXCESS":"0","EXPECTEDCREDTURNOVCUST":"0","EXPECTEDCREDTURNOVCHEQ":"0","EXCLUSIONTYPE":"","EXCLUSIONREASON":"","EXCLUSIONCREDITFACILITY":"","BEHAVSCOREMORTG":"0","BEHAVSCORELOANS":"0","BEHAVSCORECUSTALIGN":"0","BEHAVSCORECHEQ":"0","BEHAVSCORECC":"0","BEHAVSCOREAVAF":"0","AVGCTOL6ML12M":"0.00","AVGCTOL3ML6M":"0.00","AOL":"0","AMR":"0","AMMR":"0","AMLR":"0","ACCL":"0","ABRA":"0"},"INTENTSECE":{"SURETYSHIPIFOAPPLICANT":"0"},"INTENTRDET":{},"INTENTNUMPARTICIPANTS6":"","INTENTNUMPARTICIPANTS5":"","INTENTNUMPARTICIPANTS4":"","INTENTNUMPARTICIPANTS3":"","INTENTNUMPARTICIPANTS2":"","INTENTNUMPARTICIPANTS1":"","INTENTNONRESIDENT":"N","INTENTMARITALSTATUS":"","INTENTMARITALCONTRACT":"","INTENTLMTS":{},"INTENTINST":{},"INTENTINSOLVENT":"N","INTENTHIGHLEVELLIMITINDICATOR":"N","INTENTFINANCIALCRIMEHOLD":"","INTENTEXPO":{},"INTENTEXCS":{},"INTENTCTBALANCETERMDEPOSITS":"0","INTENTCTBALANCESAVINGS":"0","INTENTCTBALANCENOTICEDEPOSITS":"0","INTENTCTBALANCECUSTINVESTMENTS":"0","INTENTCTBALANCECHEQS":"0","INTENTCTBALANCECASHCOVER":"0","INTENTCMTM":{},"INTENTCLIENTTYPE":"00101","INTENTCLIENTCODE6":"","INTENTCLIENTCODE5":"","INTENTCLIENTCODE4":"","INTENTCLIENTCODE3":"","INTENTCLIENTCODE2":"","INTENTCLIENTCODE1":"","INTENTCDUCTMAINPYTURNOVER":"0","INTENTBURCOMMNOPOSSIBLEMATCH":"","INTENTBUR":{"COMMINPVATNUMBER":"","COMMINPTRADINGNAME":"","COMMINPREGNUMBER":"","COMMINPKIMNUMBER":"","COMMINPBUSNAME":"NKHUMELENI FLORENCE MATHATHO"},"INTENTARRS":{},"APPENTSHAREHOLDINGPERC":"50.00","APPENTMNTHSSHAREHOLDINGPERC":"97","APPENTINTENTIONTOINSOLVENCY":"N","APPENTIDTYPE":"01","APPENTFNST":{"TYPE_Z":"0","TURNOVER":"0","TOTALASSETTURNOVER":"0","TOTALASSETS":"0","SOLEFULLAVAILABLE":"N","SALESGROWTHPERC":"0","RETAINEDEARNINGS":"0","QUALIFIED":"0","PROJTURNOVER":"0","PROFITNET":"0","PROFITBEFORETAX":"0","PERIODOFINCSTAT":"0","OPERATINGPROFITMARGIN":"0","NETWORTH":"0","NETPROFITPERC":"0.00","LONGTERMDEBTTOEBITDA":"0","LIABTOTSTOCK":"0","LIABTOTLONGTERMDEBT":"0","LIABTOTCURRLIAB":"0","LIABSHAREHFUNDS":"0","LIABLOANTOINSIDEPARTIES":"0","LIABLOANSTOPR":"0","LIABLOANSFROMPRCEDED":"0","LIABLOANFROMOTHINSTITUTIONS":"0","ICR":"0.00","IBDTOEQUITY":"0.00","IBDTOEBITDA":"0.00","GROSSPROFITPERC":"0.00","GROSSPROFIT":"0","EBITDA":"0","CURRENTRATIO":"0.00","AVAILABLE":"N","ASSINTANGIBLES":"0","ACIDTEST":"0.00"},"APPENTEXPO":{},"APPENTBUR":{"CONSINPWRKPHNCDE":"","CONSINPWRKPHN":"","CONSINPSNAME":"MATHATHO","CONSINPRESSUBURB":"Johannesburg","CONSINPRESPOSTCDE":"2001","CONSINPRESCTY":"Johannesburg","CONSINPRESADDR2":"Johannesburg","CONSINPRESADDR1":"2 Spring Street","CONSINPPSTSUBURB":"Johannesburg","CONSINPPSTPOSTCDE":"2001","CONSINPPSTCTY":"Johannesburg","CONSINPPSTADDR1":"2 Spring Street","CONSINPOCC":"Not required or capt","CONSINPNATID":"6103260389081","CONSINPHMPHNCDE":"","CONSINPHMPHN":"","CONSINPFNAME2":"","CONSINPFNAME1":"NKHUMELENI FLOR","CONSINPEMP":"","CONSINPDOB":"19610326"},"APPENTASLB":{"TOTALPROPERTIES":"0","NOTARIALBOND":"0","NETWORTHME":"0","NETWORTHCREDIT":"0","NETWORTH":"0","DEEDSSEARCHAVAILABLE":"0","AVAILABLE":"N"},"APPENTAPRF":{},"APPENTAGEOLDESTRELATIONSHIP":"0","APPENTAGE":"5909"},"Entity03":{"INTENTUNDERJUDICIALMNGMNT":"","INTENTUNDERDEBTCOUNSELLING":"","INTENTTRID":{"TOTSAVRETPAYMNTSL6M":"","TOTCHEQRETPAYMNTSL6M":"","NUMRDEVENTSSAVL6M":"0","NUMRDEVENTSSAVL3M":"0","NUMRDEVENTSCHEQL6M":"0","NUMRDEVENTSCHEQL3M":"0","NUMMNTHSEXCESSBALL6M":"0","NUMDEBITSL6M":"0","NUMDAYSDEBITINL6M":"0","NUMDAYSCREDITINL6M":"0","MNTHSOLDESTSAVACCREL":"0","MNTHSOLDESTCUSTREL":"0","MNTHSOLDESTCHACCREL":"0","MNTHSOLDESTACCREL":"0","MAXOCSCORINGMANDATE":"0","MAXCONSECDAYSINEXCESS":"0","EXPECTEDCREDTURNOVCUST":"0","EXPECTEDCREDTURNOVCHEQ":"0","EXCLUSIONTYPE":"","EXCLUSIONREASON":"","EXCLUSIONCREDITFACILITY":"","BEHAVSCOREMORTG":"0","BEHAVSCORELOANS":"0","BEHAVSCORECUSTALIGN":"0","BEHAVSCORECHEQ":"0","BEHAVSCORECC":"0","BEHAVSCOREAVAF":"0","AVGCTOL6ML12M":"0.00","AVGCTOL3ML6M":"0.00","AOL":"0","AMR":"0","AMMR":"0","AMLR":"0","ACCL":"0","ABRA":"0"},"INTENTSECE":{"SURETYSHIPIFOAPPLICANT":"0"},"INTENTRDET":{},"INTENTNUMPARTICIPANTS6":"","INTENTNUMPARTICIPANTS5":"","INTENTNUMPARTICIPANTS4":"","INTENTNUMPARTICIPANTS3":"","INTENTNUMPARTICIPANTS2":"","INTENTNUMPARTICIPANTS1":"","INTENTNONRESIDENT":"N","INTENTMARITALSTATUS":"","INTENTMARITALCONTRACT":"","INTENTLMTS":{},"INTENTINST":{},"INTENTINSOLVENT":"N","INTENTHIGHLEVELLIMITINDICATOR":"N","INTENTFINANCIALCRIMEHOLD":"","INTENTEXPO":{},"INTENTEXCS":{},"INTENTCTBALANCETERMDEPOSITS":"0","INTENTCTBALANCESAVINGS":"0","INTENTCTBALANCENOTICEDEPOSITS":"0","INTENTCTBALANCECUSTINVESTMENTS":"0","INTENTCTBALANCECHEQS":"0","INTENTCTBALANCECASHCOVER":"0","INTENTCMTM":{},"INTENTCLIENTTYPE":"00101","INTENTCLIENTCODE6":"","INTENTCLIENTCODE5":"","INTENTCLIENTCODE4":"","INTENTCLIENTCODE3":"","INTENTCLIENTCODE2":"","INTENTCLIENTCODE1":"","INTENTCDUCTMAINPYTURNOVER":"0","INTENTBURCOMMNOPOSSIBLEMATCH":"","INTENTBUR":{"COMMINPVATNUMBER":"","COMMINPTRADINGNAME":"","COMMINPREGNUMBER":"","COMMINPKIMNUMBER":"","COMMINPBUSNAME":"HELENA JOHANNA BEETGE"},"INTENTARRS":{},"APPENTSHAREHOLDINGPERC":"50.00","APPENTMNTHSSHAREHOLDINGPERC":"132","APPENTINTENTIONTOINSOLVENCY":"N","APPENTIDTYPE":"01","APPENTFNST":{"TYPE_Z":"0","TURNOVER":"0","TOTALASSETTURNOVER":"0","TOTALASSETS":"0","SOLEFULLAVAILABLE":"N","SALESGROWTHPERC":"0","RETAINEDEARNINGS":"0","QUALIFIED":"0","PROJTURNOVER":"0","PROFITNET":"0","PROFITBEFORETAX":"0","PERIODOFINCSTAT":"0","OPERATINGPROFITMARGIN":"0","NETWORTH":"0","NETPROFITPERC":"0.00","LONGTERMDEBTTOEBITDA":"0","LIABTOTSTOCK":"0","LIABTOTLONGTERMDEBT":"0","LIABTOTCURRLIAB":"0","LIABSHAREHFUNDS":"0","LIABLOANTOINSIDEPARTIES":"0","LIABLOANSTOPR":"0","LIABLOANSFROMPRCEDED":"0","LIABLOANFROMOTHINSTITUTIONS":"0","ICR":"0.00","IBDTOEQUITY":"0.00","IBDTOEBITDA":"0.00","GROSSPROFITPERC":"0.00","GROSSPROFIT":"0","EBITDA":"0","CURRENTRATIO":"0.00","AVAILABLE":"N","ASSINTANGIBLES":"0","ACIDTEST":"0.00"},"APPENTEXPO":{},"APPENTBUR":{"CONSINPWRKPHNCDE":"","CONSINPWRKPHN":"","CONSINPSNAME":"BEETGE","CONSINPRESSUBURB":"Johannesburg","CONSINPRESPOSTCDE":"2001","CONSINPRESCTY":"Johannesburg","CONSINPRESADDR2":"Johannesburg","CONSINPRESADDR1":"12 Smith Street","CONSINPPSTSUBURB":"Johannesburg","CONSINPPSTPOSTCDE":"2001","CONSINPPSTCTY":"Johannesburg","CONSINPPSTADDR1":"12 Smith Street","CONSINPOCC":"Not required or capt","CONSINPNATID":"5012200032084","CONSINPHMPHNCDE":"","CONSINPHMPHN":"","CONSINPFNAME2":"","CONSINPFNAME1":"HELENA JOHANNA","CONSINPEMP":"","CONSINPDOB":"19501220"},"APPENTASLB":{"TOTALPROPERTIES":"0","NOTARIALBOND":"0","NETWORTHME":"0","NETWORTHCREDIT":"0","NETWORTH":"0","DEEDSSEARCHAVAILABLE":"0","AVAILABLE":"N"},"APPENTAPRF":{},"APPENTAGEOLDESTRELATIONSHIP":"0","APPENTAGE":"7002"},"Entity02":{"INTENTTRID":{},"INTENTRDET":{},"INTENTLMTS":{},"INTENTINST":{},"INTENTEXPO":{},"INTENTEXCS":{},"INTENTCMTM":{},"INTENTBUR":{},"INTENTARRS":{},"APPENTEXPO":{},"APPENTBUR":{},"APPENTAPRF":{}},"Entity01":{"INTENTWRSTRISKGRADE":"0","INTENTUNDERJUDICIALMNGMNT":"","INTENTUNDERDEBTCOUNSELLING":"","INTENTTRID":{"TOTSAVRETPAYMNTSL6M":"","TOTCHEQRETPAYMNTSL6M":"","NUMRDEVENTSSAVL6M":"0","NUMRDEVENTSSAVL3M":"0","NUMRDEVENTSCHEQL6M":"0","NUMRDEVENTSCHEQL3M":"0","NUMMNTHSEXCESSBALL6M":"0","NUMDEBITSL6M":"0","NUMDAYSDEBITINL6M":"0","NUMDAYSCREDITINL6M":"0","MNTHSOLDESTSAVACCREL":"0","MNTHSOLDESTCUSTREL":"0","MNTHSOLDESTCHACCREL":"0","MNTHSOLDESTACCREL":"0","MAXOCSCORINGMANDATE":"0","MAXCONSECDAYSINEXCESS":"0","EXPECTEDCREDTURNOVCUST":"0","EXPECTEDCREDTURNOVCHEQ":"0","EXCLUSIONTYPE":"","EXCLUSIONREASON":"","EXCLUSIONCREDITFACILITY":"","BEHAVSCOREMORTG":"0","BEHAVSCORELOANS":"0","BEHAVSCORECUSTALIGN":"0","BEHAVSCORECHEQ":"0","BEHAVSCORECC":"0","BEHAVSCOREAVAF":"0","AVGCTOL6ML12M":"0.00","AVGCTOL3ML6M":"0.00","AOL":"0","AMR":"0","AMMR":"0","AMLR":"0","ACCL":"0","ABRA":"0"},"INTENTSECE":{"SURETYSHIPIFOAPPLICANT":"N"},"INTENTRDET":{"WRSTCOLLRISKTYPE":"","WRSTARMSHOLD":"","INTENTBUSNRESC":"N","INBUSNRESC":"","EWLLISTING":"0.0","BUSNRESCAFFECTEDPARTY":""},"INTENTPARTOFCREDITGROUP":"","INTENTNUMPARTICIPANTS6":"","INTENTNUMPARTICIPANTS5":"","INTENTNUMPARTICIPANTS4":"","INTENTNUMPARTICIPANTS3":"","INTENTNUMPARTICIPANTS2":"","INTENTNUMPARTICIPANTS1":"","INTENTNONRESIDENT":"N","INTENTMARITALSTATUS":"","INTENTMARITALCONTRACT":"","INTENTLMTS":{},"INTENTINST":{},"INTENTINSOLVENT":"N","INTENTINLIQUIDATION":"","INTENTHIGHLEVELLIMITINDICATOR":"N","INTENTFRAUDRISKMNGMNT":"","INTENTFINANCIALCRIMEHOLD":"","INTENTEXPO":{"CONTINGENTLIABILITY":"0"},"INTENTEXCS":{},"INTENTCTBALANCETERMDEPOSITS":"0","INTENTCTBALANCESAVINGS":"0","INTENTCTBALANCENOTICEDEPOSITS":"0","INTENTCTBALANCECUSTINVESTMENTS":"0","INTENTCTBALANCECHEQS":"0","INTENTCTBALANCECASHCOVER":"0","INTENTCMTM":{},"INTENTCLIENTTYPE":"03101","INTENTCLIENTCODE1":"CSCC   015","INTENTCDUCTMAINPYTURNOVER":"0","INTENTCDUCTDAYSSNCELASTCREDIT":"-6","INTENTBURCOMMNOPOSSIBLEMATCH":"","INTENTBUR":{"COMMINPVATNUMBER":"4120246634","COMMINPTRADINGNAME":"","COMMINPREGNUMBER":"199801680623","COMMINPKIMNUMBER":"","COMMINPBUSNAME":"CPS SEEDLINGS CC"},"INTENTARRS":{},"APPENTWORKADDRSUBURB":"Johannesburg","APPENTWORKADDRPCODE":"2001","APPENTWORKADDRCITY":"Johannesburg","APPENTTIME":{},"APPENTSHAREHOLDINGPERC":"0","APPENTINTENTIONTOINSOLVENCY":"N","APPENTINCOMETAXNUM":"9576825153","APPENTIDTYPE":"05","APPENTGENDER":"","APPENTFNST":{"TYPE_Z":"0","TURNOVER":"0","TOTALASSETTURNOVER":"0","TOTALASSETS":"0","TMSNCECERTDATE":"0","TMSNCE":"0","SOLEFULLAVAILABLE":"N","SALESGROWTHPERC":"0","RETAINEDEARNINGS":"0","QUALIFIED":"0","PROJTURNOVER":"0","PROFITNET":"0","PROFITBEFORETAX":"0","PERIODOFINCSTAT":"0","OPERATINGPROFITMARGIN":"0","NETWORTH":"0","NETPROFITPERC":"0","LONGTERMDEBTTOEBITDA":"0","LIABTOTSTOCK":"0","LIABTOTLONGTERMDEBT":"0","LIABTOTCURRLIAB":"0","LIABSHAREHFUNDS":"0","LIABLOANTOINSIDEPARTIES":"0","LIABLOANSTOPR":"0","LIABLOANSFROMPRCEDED":"0","LIABLOANFROMOTHINSTITUTIONS":"0","ICR":"0","IBDTOEQUITY":"0","IBDTOEBITDA":"0","GROSSPROFITPERC":"0","GROSSPROFIT":"0","EBITDA":"0","CURRENTRATIO":"0","AVAILABLE":"Y","ASSINTANGIBLES":"0","ACIDTEST":"0"},"APPENTEXPO":{},"APPENTBUR":{"CONSINPWRKPHNCDE":"","CONSINPWRKPHN":"","CONSINPSNAME":"","CONSINPRESSUBURB":"","CONSINPRESPOSTCDE":"","CONSINPRESCTY":"","CONSINPRESADDR2":"","CONSINPRESADDR1":"","CONSINPPSTSUBURB":"","CONSINPPSTPOSTCDE":"","CONSINPPSTCTY":"","CONSINPPSTADDR1":"","CONSINPOCC":"","CONSINPHMPHNCDE":"","CONSINPHMPHN":"","CONSINPFNAME2":"","CONSINPFNAME1":"","CONSINPEMP":"","CONSINPDOB":""},"APPENTASLB":{"TOTALPROPERTIES":"0","NOTARIALBOND":"0","NETWORTHME":"0","NETWORTHCREDIT":"0","NETWORTH":"0","DEEDSSEARCHAVAILABLE":"0","AVAILABLE":"N"},"APPENTAPRF":{},"APPENTAPPLCATEGORY":"","APPENTAGEOLDESTRELATIONSHIP":"0","APPENTAGE":"0000"},"DERPCOUNIQUENUMBER":"000000014410","AppData":{"INTAPPSECE":{"SPECASVALL":"0","SPECASVACCSSETTLE":"0","PERCNORMCHANGED":"Y","OUSTANDINGSEC":"N","MASVAGRI":"0","CASHCOVER":"0","APPRSECVALUE":"0"},"INTAPPNCAP":{"UCTMAXSERVICEFEES":"69","UCTINTERESTRATE":"27.75","UCTINITFEESTHRESHOLD":"1000","UCTINITFEESNEXTPERC":"11.5","UCTINITFEESMAX":"6040.5","UCTINITFEESFIRST":"189.75","STCTMAXSERVICEFEES":"69","STCTINTERESTRATE":"60","STCTINITFEESTHRESHOLD":"1000","STCTINITFEESNEXTPERC":"11.5","STCTINITFEESMAX":"1207.5","STCTINITFEESFIRST":"189.75","REPORATE":"7","PRIMERATE":"6.0","OCAMAXSERVICEFEES":"69","OCAINTERESTRATE":"21","OCAINITFEESTHRESHOLD":"1000","OCAINITFEESNEXTPERC":"11.5","OCAINITFEESMAX":"1207.5","OCAINITFEESFIRST":"189.75","MAMAXSERVICEFEES":"69","MAINTERESTRATE":"19","MAINITFEESTHRESHOLD":"10000","MAINITFEESNEXTPERC":"11.5","MAINITFEESMAX":"6037.5","MAINITFEESFIRST":"1265","CAMAXSERVICEFEES":"69","CAINTERESTRATE":"20.75","CAINITFEESTHRESHOLD":"1000","CAINITFEESNEXTPERC":"11.5","CAINITFEESMAX":"6050.5","CAINITFEESFIRST":"189.75"},"INTAPPEXPO":{"TOTALGROUPEXPOSURE":"0","TGOE":"0","TGBE":"0","TGAE":"0","POLICYIND":""},"INTAPPCCLP":{"TLCREDITLIFEMINAMNT":"0","TLCREDITLIFEMAXAMNT":"0","ODCREDITLIFEMINAMNT":"0","ODCREDITLIFEMAXAMNT":"0"},"INTAPPAFFECTEDPERSREG31F":"","INTAPPABSA":{"CHQACCRELATIONSHIP":""},"APPAPPWCRM":{"TTCPD":"0","TTCDG":"0","TIMSNCECAPTURE":"0","PITPD":"0","PITDG":"0","AVAILABLE":"0"},"APPAPPSECUREDBYMORTGAGEBOND":"Y","APPAPPSECO":{"SUPPORTINGSPECIFIC":"0","SUPPORTINGNONSPECIFIC":"0","ASVOFFERED":"825123","ASVADDOFFERED":"0"},"APPAPPQUAL":{"RESUPPORTAPPLICATION":"N","PREVIOUSWOFFBUSFAILURE":"N","OTHERNEGKNOWLEDGE":"N","EXPINCREASEL6TO12M":"N","DISPUTEBETWEENPARTIES":"N","DEBTORBOOKFUNDING":"N","CHANGEKEYMNGMNTL12M":"N","CHANGEBUSDIRECTION":"N","ARREARSSARS":"N","ACCOTHERBANK":"N"},"APPAPPNUMPARTICIPANTS":"","APPAPPNUMKEYPRINCIPALS":"2","APPAPPNUMCOREPRINCIPALS":"2","APPAPPNONRESPRINCIPALS":"0","APPAPPMNTHSSINCEBUSESTABLISHED":"381","APPAPPMIAE":{"STATDEDOTHERSPSE":"0","STATDEDOTHERAPL":"0","STATDEDMAINTSPSE":"0","STATDEDMAINTAPL":"0","INSTEXTDECLSPSE":"0","INSTEXTDECLAPL":"0","INSTEXTADJSPSE":"0","INSTEXTADJAPL":"0","INSTCBURNONABSASPSE":"0","INSTCBURNONABSAAPL":"0","INSTABSASPSE":"0","INSTABSAAPL":"0","INCNETSPSE":"0","INCNETHH":"0","INCNETAPL":"0","INCMAINTSPSE":"0","INCMAINTAPL":"0","INCGROSSSPSE":"0","INCGROSSHH":"0","INCGROSSAPL":"0","INCDISCRETDECLADJ":"0","INCDISCRETDECL":"0","EXPWATERELECTRICITY":"0","EXPTRANSPORT":"0","EXPTOTALDECLADJ":"0","EXPTOTALDECL":"0","EXPTELECOMMS":"0","EXPTAX":"0","EXPSECURITY":"0","EXPOTHER":"0","EXPMULTICHOICE":"0","EXPMEDICAL":"0","EXPMAINTSPSE":"0","EXPMAINTAPL":"0","EXPINSURANCE":"0","EXPFOOD":"0","EXPENTERTAINMENT":"0","EXPEDUCATION":"0","EXPDOMESTICWAGES":"0","EXPACCOMMODATION":"0"},"APPAPPEXTR":{"TLNACC":"N","SAVAMNT":"0","SAVACC":"N","MLOANAMNT":"0","MLOANACC":"N","INVAMNT":"0","INVACC":"N","CHEQAMNT":"0","CHEQACC":"N","CARDAMNT":"0","CARDACC":"N","ASSETAMNT":"0","ASSETACC":"N"},"APPAPPBSTM":{"TURNOVER":"0","PERIOD":"0","ODLIMITS":"0","NUMRDITEMS":"0","MINBALANCE":"0"}},"APPBANKERNUMBER":"2479519","APPAPPTRADINGINDICATOR":"Y","APPAPPSTOKVELAPPLICATION":"Y","APPAPPSTAGEID":"08","APPAPPREQUESTEDFRANCHISORTYPE":"","APPAPPREQUESTEDFRANCHISEFINANCING":"N","APPAPPPRICINGREFERTIME":"155532","APPAPPPRICINGREFERDATE":"2021-03-12","APPAPPFORMALAPPINDICATOR":"N","APPAPPFOREIGNCONTROLLEDPERC":"0","APPAPPEXTRTLAMNT":"0","APPAPPESPINSTRUCTION":"0000032787","APPAPPENTERPRDEVFUNDREQ":"","APPAPPCREDITREFERTIME":"","APPAPPCREDITREFERDATE":"","APPAPPAPPLICATIONTYPE":"O","APPAPPAPPLICATIONTIME":"112357","APPAPPAPPLICATIONSUBSTATUS":"","APPAPPAPPLICATIONSTATUS":"P","APPAPPAPPLICATIONNUMBER":"47000355587","APPAPPAPPLICATIONDATE":"2021-03-05"}}}';

        PowerCurveUpdateApplication_Req_IB_v1 pcoUpdateRequestBean = (PowerCurveUpdateApplication_Req_IB_v1)Json.deserialize(requestP, PowerCurveUpdateApplication_Req_IB_v1.class);

        Opportunity opp = [select Id, accountId from Opportunity];
        List<Application_Product__c> reqProds =[Select id, Name ,Product_Name__c,Account_Number__c,Product_State__c,Limit_Type__c,Product_Status__c,Final_Decision_Date_Time__c,
                                                (Select id,Application_Product__c,TOB_Classification__c,Tob_Description__c,Adjusted_by_Sanctioner_Picklist__c,Requested_Picklist__c,Requested_Frequency_Picklist__c,
                                                 Adjusted_by_Sanctioner__c,Comments__c,Existing_Account__c,Final_Offered__c,Adjusted_By_Sanctioner_Frequency__c,
                                                 Offered_by_Powercurve__c,Requested_Amount__c,Existing_Account_Number__c,Final_Offered_Number__c,
                                                 PowerCurve_Offered_Number__c,Adjusted_Number__c,Adjusted_Date__c,Existing_Account_Date__c,Final_Offered_Date__c,
                                                 PowerCurve_Offered_Date__c,
                                                 Requested_Number__c,Requested_Date__c from Terms_Of_Business__r ) from Application_Product__c Where Opportunity__c =:opp.Id AND Application_Product_Parent__c=null AND Product_State__c='New'];

        List<Application_Product__c> existingProds = [Select id, Name ,Product_Name__c,Account_Number__c,Product_State__c,Limit_Type__c,Product_Status__c,Final_Decision_Date_Time__c,
                                                      (Select id,Application_Product__c,TOB_Classification__c,Tob_Description__c,Adjusted_by_Sanctioner_Picklist__c,Requested_Picklist__c,Requested_Frequency_Picklist__c,
                                                       Adjusted_by_Sanctioner__c,Comments__c,Existing_Account__c,Final_Offered__c,Adjusted_By_Sanctioner_Frequency__c,
                                                       Offered_by_Powercurve__c,Requested_Amount__c,Existing_Account_Number__c,Final_Offered_Number__c,
                                                       PowerCurve_Offered_Number__c,Adjusted_Number__c,Adjusted_Date__c,Existing_Account_Date__c,Final_Offered_Date__c,
                                                       PowerCurve_Offered_Date__c,
                                                       Requested_Number__c,Requested_Date__c from Terms_Of_Business__r ) from Application_Product__c Where Opportunity__c =:opp.Id AND Application_Product_Parent__c=null AND Product_State__c='existing' ];


        Test.startTest();
        System.assert(PowerCurveUpdateController8.mapPowerCureveUpdateRequest(pcoUpdateRequestBean, opp.Id,8) != null, true);
        System.assert(PowerCurveUpdateController8.mapStage8Fields(pcoUpdateRequestBean,opp.Id) != null, true);
        Test.stopTest();
    }
}