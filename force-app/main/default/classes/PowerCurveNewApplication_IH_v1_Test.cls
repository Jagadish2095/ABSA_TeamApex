/*
 * Integration Handler for PowerCurveUpdateApplication Service
 * @author Englarmerdge Mongwe
 * @created 2020-09-28
 */

@IsTest
public class PowerCurveNewApplication_IH_v1_Test {
    public static final String POSITIVE_RESPONSE_BODY = '{"Response":{"ApplicationDV":{"APPAPPAPPLICATIONNUMBER":46000125808,"DERPCOUNIQUENUMBER":"000000004950","DerivedCalcAppData":{"DERAPPPRIN":{"PRINCAPPLICABLEIND":"Y"},"DERAPPSPSE":{"SPOUSEDETAILSREQUIREDIND":"N"},"DERAPPGPAM":{"REQMAXTERMVSPURPSLOANMAXTERM":0,"REQMAXTERMVSPURPSLOANNOTBOND":"N"},"DERAPPPAPR":{"PREAPPRIND":"N","PREAPPRREPROCESSLOWERLMTIND":"N"},"DERAPPEXPO":{"REQTOTADDPOTENTIALOC":0,"REQPOTENTIALTOTDIRECT":0,"REQPOTENTIALTOTGROUP":515574,"REQPOTENTIALTGBE":0,"REQPOTENTIALTGAE":515574,"REQPOTENTIALTGOE":0,"REQPOTENTIALTFL":0}},"StratRes1":{"RESAPPSCRD":{"CHEQCUTOFF":156,"ODCUTOFF":156,"BCCCUTOFF":156,"FCCUTOFF":156,"GCCUTOFF":156,"TLCUTOFF":133,"BRLCUTOFF":0,"EPSCUTOFF":0,"BGCUTOFF":156,"TRFCUTOFF":156,"AGRICUTOFF":0,"CPFCUTOFF":0,"MOODYCUTOFF":0,"ORDCREDLIMIT":2000000,"ORDCREDSCORINGMANDATE":2500000},"RESAPPGPAM":{"EXPILLUSTDAYSNODECISION":30,"EXPILLUSTDAYSAFTERDECISION":30,"EXPILLUSTDAYSREMOVE":60,"ABSADATARFRESHPERIOD":7,"FRAUDREFERRALPROCESS":30,"GUINESSRATING":39},"RESAPPCMNG":{"REMAXOFFSETREDUC":0,"REMINPLUSMINRATE":1,"SMMAXOFFSETREDUC":0.5,"SMMINPLUSMINRATE":0.5,"PMMAXOFFSETREDUC":1,"PMMINPLUSMINRATE":0,"HOCMMAXOFFSETREDUC":8,"HOCMMINPLUSMINRATE":0},"RESAPPEXCS":{"WRSTPRINCIPALP1VP2":"Z"}},"Entity":{"INTENTCLIENTCODE1":"KHCC 001","INTENTAPRF":{"RETAILOCE":0,"RETAILOCINST":0,"RETAILMLOANEXP":0,"RETAILMLOANINST":0,"BBOCE":0,"BBOCEINST":0,"BBMLOANEXP":0,"BBMLOANINST":0},"APPENTIDTYPE":"05","INTENTBUR":{"COMMINPREGNUMBER":199303044823}},"DerivedCalcEntity":[{"DERENTCUST":{"EXISTINGCLIENTINDICATOR":"N","EXISTINGCREDCLIENTINDICATOR":"N"},"DERENTINST":{"TOTALINSTALLMENTS":0},"DERENTLMTS":{"TOTALLIMIT":0},"DERENTEXCS":{"TOTALAMNT":0,"INDICATOR":"Z"},"DERENTARRS":{"TOTALAMNT":0,"INDICATOR":"Z"},"DERENTSTOR":{"STRENGTHRELATIONSHIP":"W"}},{"DERENTCUST":{"EXISTINGCLIENTINDICATOR":"N","EXISTINGCREDCLIENTINDICATOR":"N"},"DERENTINST":{"TOTALINSTALLMENTS":0},"DERENTLMTS":{"TOTALLIMIT":0},"DERENTEXCS":{"TOTALAMNT":0,"INDICATOR":"Z"},"DERENTARRS":{"TOTALAMNT":0,"INDICATOR":"Z"},"DERENTSTOR":{"STRENGTHRELATIONSHIP":"N"}},{"DERENTCUST":{"EXISTINGCLIENTINDICATOR":"N","EXISTINGCREDCLIENTINDICATOR":"N"},"DERENTINST":{"TOTALINSTALLMENTS":0},"DERENTLMTS":{"TOTALLIMIT":0},"DERENTEXCS":{"TOTALAMNT":0,"INDICATOR":"Z"},"DERENTARRS":{"TOTALAMNT":0,"INDICATOR":"Z"},"DERENTSTOR":{"STRENGTHRELATIONSHIP":"N"}},{"DERENTCUST":{"EXISTINGCLIENTINDICATOR":"N","EXISTINGCREDCLIENTINDICATOR":"N"},"DERENTINST":{"TOTALINSTALLMENTS":0},"DERENTLMTS":{"TOTALLIMIT":0},"DERENTEXCS":{"TOTALAMNT":0,"INDICATOR":"Z"},"DERENTARRS":{"TOTALAMNT":0,"INDICATOR":"Z"},"DERENTSTOR":{"STRENGTHRELATIONSHIP":"N"}},{"DERENTCUST":{"EXISTINGCLIENTINDICATOR":"N","EXISTINGCREDCLIENTINDICATOR":"N"},"DERENTINST":{"TOTALINSTALLMENTS":0},"DERENTLMTS":{"TOTALLIMIT":0},"DERENTEXCS":{"TOTALAMNT":0,"INDICATOR":"Z"},"DERENTARRS":{"TOTALAMNT":0,"INDICATOR":"Z"},"DERENTSTOR":{"STRENGTHRELATIONSHIP":"N"}}],"APPERRMSG":"000"}}}';

    @TestSetup
    static void makeData(){
        IntegrationTestDataFactory.insertIntegrationSettings(StringConstants.JITTERBIT2, new List<String>{PowerCurveNewApplication_IH_v1.INTEGRATION_SERVICE_NAME});
    }

    @isTest 
    static void testPositive() {
        // Set mock callout class
        Test.setMock(HttpCalloutMock.class, new Sys_Utilities_Integration_Mock_ApiRest(StringConstants.POSITIVE_STRING, POSITIVE_RESPONSE_BODY));

        Test.startTest();

        PowerCurveNewApplication_Resp_IB_v1 responseBean = callHandlerMethod();
        System.assertEquals(200, responseBean.statusCode);

        Test.stopTest();
    }
 
    private static PowerCurveNewApplication_Resp_IB_v1 callHandlerMethod() {
        PowerCurveNewApplication_Req_IB_v1 dummyBean = PowerCurveNewApplication_Req_IB_v1.createDummyRequest();
        System.debug('dummyBean: ' + dummyBean);
        PowerCurveNewApplication_Resp_IB_v1 responseBean = PowerCurveNewApplication_IH_v1.powerCurveNewApplication(dummyBean);
        return responseBean;
    }
}