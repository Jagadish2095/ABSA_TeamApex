/**
* @description       : Test for for EntityHierarchyCreate_IH_v1
* @author            : Himanshu.Nimje@absa.africa
* @last modified on  : 2021-11-09
* @last modified by  : Tawanda M.
* Modifications Log
* Ver   Date         Author                       Modification
* 1.0   2021-10-28   Himanshu.Nimje@absa.africa   Initial Version
**/

@IsTest
public class EntityHierarchyCreate_IH_v1_Test {
    
    public static final String POSITIVE_RESPONSE_BODY = '{"payLoad":[{"disableCreate":{},"EntityType":"023","SalesforceEntityType":"Private Company","LongName":"ZEMBE AFRICAN OUTFITTERS (PTY) LTD","ShortName":"ZEMBE AFRICAN OUTFITTERS (PTY) LTD","EntityId":13,"ClientCode":"ZAOUTFI003","SystemId":"0011x000019DvOBAA0","IdType":null,"LegalEntity":null,"TaxId":null,"PlaceOfResidence":1,"CustomerSince":"2020-12-06T00:00:00Z","CountryOfInc":null,"ProvinceStateOfIncorporation":null,"EstablishmentDate":"2020-12-07T00:00:00Z","IdNumber":null,"TrustDeed":null,"RegistrationNumber":"2012/192479/07","PassportNumber":null,"CustomerState":1,"OnList":null,"Descriptions":null,"Gc23":null,"Gc22":null,"LockedDate":null,"ExternalDataSources":["Salesforce"],"LockedBy":null,"ValuationMethodology":"NotAvailable","Bankruptcy":"Unknown","EnterpriseValueToTotalDebt":"NotAvailable","IndustrySector":null,"GovernmentBailoutOfFirm":null,"BusinessPortfolio":"Commercial","Division":null,"CreditPortfolio":"Commercial","PrimaryBankingOfficer":null,"PrimaryCreditOfficer":null,"Rules":{"ValidateOfficerTitleCSharp":{"success":true,"data":{},"ruleName":"ValidateOfficerTitleCSharp"},"ValidateIndustryCodes":{"success":true,"data":{},"ruleName":"ValidateIndustryCodes"},"ValidateEntityHierarchyRatios":{"success":true,"data":{},"ruleName":"ValidateEntityHierarchyRatios"},"ValidateEntityReorgHistory":{"success":true,"data":{},"ruleName":"ValidateEntityReorgHistory"},"ValidateEntityCreditHierarchyRatios":{"success":true,"data":{},"ruleName":"ValidateEntityCreditHierarchyRatios"},"ValidateEntityHierarchyUniqueness":{"success":false,"data":{"message":"Entity.message.hierarchy.saveConnection.duplicated"},"ruleName":"ValidateEntityHierarchyUniqueness"},"ValidateCircularRelationship":{"success":true,"data":{},"ruleName":"ValidateCircularRelationship"},"ValidateRestrictedEntityUser":{"success":true,"data":{},"ruleName":"ValidateRestrictedEntityUser"},"ValidateRestrictedUserModelAccess":{"success":true,"data":{},"ruleName":"ValidateRestrictedUserModelAccess"},"RemoveBvdFromExternalDataSource":{"success":true,"data":{},"ruleName":"RemoveBvdFromExternalDataSource"},"RemoveMarqFromExternalDataSource":{"success":true,"data":{},"ruleName":"RemoveMarqFromExternalDataSource"}},"t_":"Entity","IsValid_":true,"IsDeleted_":false,"OperationType":"Update","Access_":5,"BaseVersionId_":19,"VersionId_":20,"Inapplicable_":[],"Associations_":["SpreadDocument","SpreadProposal","CovenantAdvanced","CovenantTrackingProposal","CovenantTrackingTask","EntityCovenantStatistic","ActiveTesting","HistoryTesting","StatementSelection","Covenant","CovenantAdvancedEntityLink","EntityCreditMemo","EntityCreditMemoDocument","MarqAttribute","MapInstance","RiskGradingSettings","RiskGradingCeSettings","RatingScenario","EntityRating","ProductBorrower","Collateral","Product","EntityDealInfo","Asset","AssetBorrower","AssetOwner","AuthorizedEntity","CollateralProvider","AssetEntityLink","Financial","BvdAttribute","OsirisAttribute","EntityHierarchy","EntityReOrgHistory","EntityIndustry","EntityOfficers","Contact","Address","DirectorAndCompanyOfficer","Document","EntityGroup","BusinessProposal","RestrictedEntityUser","EntityGroupEntityLink","EntityDocumentLink"],"FirmType":"PRV","CountryOfRisk":"ZAF","Currency":"ZAR","ListingDate":null,"CountryOfListing":null,"StockExchange":null,"StockCode":null,"IndClassification":"SIC","SaSicCode":"30600","RestrictedEntityUser":[],"EntityOfficers":[],"EntityContactCreateAndEdit":[],"EntityAddress":[],"EntityGroupGrid":[],"IndustrySelection":[{"IndustryId":8,"IndustryCode":{"Code":"3677","Description":"Electronic coils, transformers and other inductors","Keys":["D","36","3677"]},"Percentage":1,"IsPrimary":true,"EntityId":13,"Classification":"SIC","ExternalDataSource":null,"UpdatePeerSelection":false,"t_":"EntityIndustry","IsValid_":true,"IsDeleted_":false,"Access_":5,"BaseVersionId_":11,"VersionId_":12,"Inapplicable_":[]}],"DirectorAndCompanyOfficer":[],"EntityHierarchy":[{"From":{"EntityId":13},"To":{"EntityId":14},"RelationshipType":"LegalBorrowing","RelationshipRole":"LegalSubsidiary","HierarchyType":"LEGAL","HierarchyControl":"YES","OwnershipPct":0.33,"Rules":{"ValidateEntityHierarchyRatiosTriggeredByHierarchy":{"success":true,"data":{},"ruleName":"ValidateEntityHierarchyRatiosTriggeredByHierarchy"},"ValidateEntityHierarchyUniquenessTriggeredByEntityHierarchy":{"success":false,"data":{"message":"Entity.message.hierarchy.saveConnection.duplicated"},"ruleName":"ValidateEntityHierarchyUniquenessTriggeredByEntityHierarchy"},"ValidateCircularRelationshipTriggeredByEntityHierarchy":{"success":true,"data":{},"ruleName":"ValidateCircularRelationshipTriggeredByEntityHierarchy"},"SendAlertForLegalHierarchyChanged":{"success":true,"data":{},"ruleName":"SendAlertForLegalHierarchyChanged"}},"t_":"EntityHierarchyLegal","OperationType":"Create"},{"From":{"EntityId":13},"To":{"EntityId":14},"RelationshipType":"CreditOwnership","RelationshipRole":"CreditParent","HierarchyType":"CREDIT","CreditAggregationPct":1,"Rules":{"ValidateEntityCreditHierarchyRatiosTriggeredByHierarchy":{"success":true,"data":{},"ruleName":"ValidateEntityCreditHierarchyRatiosTriggeredByHierarchy"},"ValidateEntityHierarchyRatiosTriggeredByHierarchy":{"success":true,"data":{},"ruleName":"ValidateEntityHierarchyRatiosTriggeredByHierarchy"},"ValidateEntityHierarchyUniquenessTriggeredByEntityHierarchy":{"success":false,"data":{"message":"Entity.message.hierarchy.saveConnection.duplicated"},"ruleName":"ValidateEntityHierarchyUniquenessTriggeredByEntityHierarchy"},"ValidateCircularRelationshipTriggeredByEntityHierarchy":{"success":true,"data":{},"ruleName":"ValidateCircularRelationshipTriggeredByEntityHierarchy"},"SendAlertForLegalHierarchyChanged":{"success":true,"data":{},"ruleName":"SendAlertForLegalHierarchyChanged"}},"t_":"EntityHierarchyCredit","OperationType":"Create"},{"LinkId":3,"From":{"EntityId":13,"LongName":"ZEMBE AFRICAN OUTFITTERS (PTY) LTD","EntityType":"023","CountryOfInc":null,"BusinessPortfolio":"Commercial","CreditPortfolio":"Commercial","RestrictedEntity":null,"RestrictedUsers":[],"Access_":5},"To":{"EntityId":14,"LongName":"TEST STANDALONE CC","EntityType":"031","CountryOfInc":null,"BusinessPortfolio":"Commercial","CreditPortfolio":"Commercial","RestrictedEntity":null,"RestrictedUsers":[],"Access_":5},"RelationshipType":"LegalBorrowing","RelationshipRole":"LegalSubsidiary","HierarchyType":"LEGAL","HierarchyControl":"YES","OwnershipPct":0.33,"t_":"EntityHierarchyLegal","IsValid_":true,"IsDeleted_":false,"Access_":5,"BaseVersionId_":0,"VersionId_":1,"Inapplicable_":[]},{"LinkId":4,"From":{"EntityId":13,"LongName":"ZEMBE AFRICAN OUTFITTERS (PTY) LTD","EntityType":"023","CountryOfInc":null,"BusinessPortfolio":"Commercial","CreditPortfolio":"Commercial","RestrictedEntity":null,"RestrictedUsers":[],"Access_":5},"To":{"EntityId":14,"LongName":"TEST STANDALONE CC","EntityType":"031","CountryOfInc":null,"BusinessPortfolio":"Commercial","CreditPortfolio":"Commercial","RestrictedEntity":null,"RestrictedUsers":[],"Access_":5},"RelationshipType":"CreditOwnership","RelationshipRole":"CreditParent","HierarchyType":"CREDIT","CreditAggregationPct":1,"t_":"EntityHierarchyCredit","IsValid_":true,"IsDeleted_":false,"Access_":5,"BaseVersionId_":0,"VersionId_":1,"Inapplicable_":[]}],"EntityReOrgHistory":[],"MarqAttribute":{"EntityId":13,"MarqScore":null,"PeerScore":null,"EffectiveDate":null,"HasMarqAssociation":false,"BusinessId":null,"HasMarqAlerts":null,"MarqAttributeId":1,"LenderId":null,"PartyType":null,"t_":"MarqAttribute","IsValid_":true,"IsDeleted_":false,"BaseVersionId_":0,"VersionId_":1,"Inapplicable_":[],"Associations_":["MarqStmtPeriod","MarqHistoricalScore","MarqRelatedPartyInfo","MarqPackageLoanInfo","MarqOtherLoanInfo"],"MarqPackageLoanInfo":[],"MarqOtherLoanInfo":[],"MarqStmtPeriod":[],"MarqHistoricalScore":[],"MarqRelatedPartyInfo":[]},"EntityDocumentLinkVm":[],"BankFocusAttribute":{"EntityId":13,"HasBvdAssociation":false,"BvdId":null,"BvdLongName":null,"Isin":null,"IndependenceIndicator":"","BvdStatus":null,"BankHistory":null,"Website":null,"PhoneNo":null,"FormatType":null,"IndexNo":[],"ConsolidationCode":[],"BvdDataSource":null,"BvdAttributeId":1,"t_":"BvdAttribute","IsValid_":true,"IsDeleted_":false,"BaseVersionId_":0,"VersionId_":1,"Inapplicable_":[],"Associations_":["BvdStmtPeriod"],"BvdStmtPeriod":[]},"OsirisAttribute":{"EntityId":13,"HasBvdAssociation":false,"BvdId":null,"BvdLongName":null,"Isin":null,"BvdStatus":null,"BankHistory":null,"Website":null,"PhoneNo":null,"ConsolidationCode":[],"BvdDataSource":null,"OsirisAttributeId":1,"OtherConsolidationCode":[],"SrcForFinancials":null,"t_":"OsirisAttribute","IsValid_":true,"IsDeleted_":false,"BaseVersionId_":0,"VersionId_":1,"Inapplicable_":[],"Associations_":["BvdStmtPeriod"],"BvdStmtPeriod":[]},"UpdatedBy_":null}],"status":{"error":[{"ResourceId":"Core.message.prerules.failed","ShowMessage":true}]}}';
    @TestSetup
    static void makeData() {
        IntegrationTestDataFactory.insertIntegrationSettings(
            StringConstants.JITTERBIT2,
            new List<String>{ EntityHierarchyCreate_IH_v1.INTEGRATION_SERVICE_NAME }
        );
    }
    
    @isTest
    static void testPositive() {
        // Set mock callout class
        cmsEntityHierarchyCreate();
        
        Test.startTest();
        
        EntityHierarchyCreate_Resp_IB_v1 resp = (EntityHierarchyCreate_Resp_IB_v1) JSON.deserialize(POSITIVE_RESPONSE_BODY.replace('status', 'status_z'),EntityHierarchyCreate_Resp_IB_v1.class);
        EntityHierarchyCreate_Resp_IB_v1 responseBean = callHandlerMethod();
        System.assertNotEquals(null, responseBean);
        
        Test.stopTest();
    }
    
    /**
* @description Mock Test
* @author Himanshu.Nimje@absa.africa | 2021-10-28
**/
    public static void cmsEntityHierarchyCreate() {
        Test.setMock(HttpCalloutMock.class, new Sys_Utilities_Integration_Mock_ApiRest(StringConstants.POSITIVE_STRING, POSITIVE_RESPONSE_BODY));
    }
    
    private static EntityHierarchyCreate_Resp_IB_v1 callHandlerMethod() {
        
        EntityHierarchyCreate_Req_IB_v1 dummyBean = EntityHierarchyCreate_Req_IB_v1.createDummyRequest();
        EntityHierarchyCreate_Resp_IB_v1 responseBean = EntityHierarchyCreate_IH_v1.EntityHierarchyCreate(dummyBean,'ADHAUS 003');
        return responseBean;
        
    }
    
}