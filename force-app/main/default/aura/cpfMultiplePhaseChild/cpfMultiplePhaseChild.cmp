<!--
* Lightning Component for Onboarding CPF Single Multiple Phase
*@author  Diksha Wasekar : Absa
* @version v1.0
* @since   2021-26-04
*
-->
<aura:component controller="CPFSingleMultiplePhaseController"
                implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes,force:lightningQuickAction"
                access="global">
    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
    <aura:attribute name="accItem" type="Application_Phase_CPF__c" />
    <aura:attribute name="newMultiplePhase" type="Application_Phase_CPF__c[]" />
    <aura:attribute name="rowindex" type="String" />
    <aura:attribute name="isActiveRemoveAccount" type="Boolean" default="false" />
    <aura:attribute name="appFinAccRecId" type="Id" />
    <aura:attribute name="newFacilityAccountMulti" type="Application_Financial_Account__c[]" />
    <!--<aura:attribute name="afaList" type="Application_Financial_Account__c[]" />-->
    <aura:attribute name="newFeesOtherFaciMulti" type="Application_Fees__c[]" />
    <aura:attribute name="newFeesOtherFeesMulti" type="Application_Fees__c[]" />
    <aura:attribute name="showIntrestServiceFreqandAmt" type="Boolean" default="false" />
    <aura:attribute name="appProdCPFId" type="Id" />   
    <aura:attribute name="recordId" type="Id" />
    
    <aura:method name="multiPhaseSaveAFA" description="Sample method with parameter">
        <aura:attribute name="message" type="String" default="multiPhaseSaveAFA default message" />
        <aura:attribute name="afaRecs" type="Application_Financial_Account__c[]" default="" />
    </aura:method>
    <aura:method name="multiPhaseSavefacifees" description="Sample method with parameter">
        <aura:attribute name="message" type="String" default="multiPhaseSaveAFA default message" />
        <aura:attribute name="facifeesRecs" type="Application_Fees__c[]" default="" />
    </aura:method>
    <aura:method name="multiPhaseSaveotherfees" description="Sample method with parameter">
        <aura:attribute name="message" type="String" default="multiPhaseSaveAFA default message" />
        <aura:attribute name="otherfeesRecs" type="Application_Fees__c[]" default="" />
    </aura:method>
    
    <lightning:messages />
    
    <!-- Register Application Events -->
    <aura:registerEvent name="CPFLimitedandUnlimitedGauranteesevent" type="c:CPFLimitedandUnlimitedGauranteesevent"/>
    <aura:registerEvent name="CPFApplicationFinAcctobeclosed" type="c:CPFApplicationFinAcctobeclosed"/>
    <aura:registerEvent name="CPFApplicationFinancialAccCreation" type="c:CPFApplicationFinancialAccCreation"/>
    
    <aura:handler name="CPFApplicationFinancialAccCreation" event="c:CPFApplicationFinancialAccCreation" action="{!c.handleApplicationEvent}"/>
    <aura:handler name="CPFLimitedandUnlimitedGauranteesevent" event="c:CPFLimitedandUnlimitedGauranteesevent" action="{!c.handleOthefaciApplicationEvent}"/>
    <aura:handler name="CPFLimitedandUnlimitedGauranteesevent" event="c:CPFLimitedandUnlimitedGauranteesevent" action="{!c.handleOthefeesApplicationEvent}"/>
    <!--<aura:handler name="CPFApplicationFinAcctobeclosed" event="c:CPFApplicationFinAcctobeclosed" action="{!c.handleApplicationEventacct}"/>-->
    
    <!-- Register Application Events -->
    
    <!--<lightning:recordEditForm aura:id="appMultiPhaseRecord" objectApiName="Application_Phase_CPF__c"  >-->
    
    <div class="slds-grid slds-wrap slds-gutters_medium">
        <div class="slds-col slds-size_1-of-2">
            <span >
                <p>Existing Account</p>
                <ui:outputText aura:id="uniqueID" value="{!v.rowindex + 1}"/>
            </span>
        </div>
        <div class="slds-col slds-size_1-of-2">
            <span >
                <ui:inputCheckbox class="slds-float_left" label="&nbsp; Remove these account details.(This action is not reversible.)" aura:id="chkRemoveThisAccount" change="{!c.onCheckedRemoveAccount}" />
                <aura:if isTrue="{!v.isActiveRemoveAccount}">
                    <lightning:button class="slds-float_right" label="Remove Account" variant="brand" onclick="{!c.removeAccount}" />
                </aura:if>
            </span>
        </div>
        <lightning:accordion activeSectionName="Multiple Phase Facility" allowMultipleSectionsOpen="false">
            <lightning:accordionSection name="Multiple Phase Facility" label="Multiple Phase Facility" >
                <lightning:recordEditForm aura:id="appPhasecpf" objectApiName="Application_Phase_CPF__c" recordId="{!v.accItem.Id}" >
                    <div class="slds-grid slds-wrap slds-gutters_medium">
                        <div class="slds-col slds-size_1-of-1">
                            <span >
                                <lightning:inputField fieldName="Phase_Number__c" aura:id="phasenumber" value="{!v.accItem.Phase_Number__c}"/>
                            </span>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <span >
                                <lightning:inputField fieldName="Drawdown_Amount__c" aura:id="drawdownamtsingle" value="{!v.accItem.Drawdown_Amount__c}"/>
                            </span>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <span >
                                <lightning:inputField fieldName="Retention_Amount__c" aura:id="retentionamtsingle" value="{!v.accItem.Retention_Amount__c}"/>
                            </span>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <span >
                                <lightning:inputField fieldName="Capitalised_Interest__c" aura:id="capitalinterestsingle" value="{!v.accItem.Capitalised_Interest__c}"/>
                            </span>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <span >
                                <label class="slds-form-element__label">
                                    <span class="slds-m-right_small">Include VAT on charges</span>
                                    <lightning:helptext icon-name="utility:like" content="Select Yes if VAT must be added on charges and costs VAT on charges and costs: R[AMOUNT]" />
                                </label>
                                <c:DynamicPicklistValueRenderer aura:id="DynamicPicklist"
                                                                picklistfieldName="Include_VAT_on_charges__c"
                                                                objectName="Application_Phase_CPF__c"
                                                                value="{!v.accItem.Include_VAT_on_charges__c}"/>
                            </span>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <span >
                                <label class="slds-form-element__label">
                                    <span class="slds-m-right_small">Include balance on existing account</span>
                                    <lightning:helptext icon-name="utility:like" content="Select yes if balance on existing account must be included in Total Facility limit" />
                                </label>
                                
                                <c:DynamicPicklistValueRenderer aura:id="DynamicPicklist"
                                                                picklistfieldName="Include_balance_on_existing_account__c"
                                                                objectName="Application_Phase_CPF__c"
                                                                value="{!v.accItem.Include_balance_on_existing_account__c}" />
                            </span>
                        </div>
                        <aura:if isTrue="{!v.accItem.Include_balance_on_existing_account__c =='Yes'}">
                            <div class="slds-col slds-size_1-of-2">
                                <span >
                                    <aura:iteration items="{!v.newFacilityAccountMulti}" var="nFacilityAccItemMulti" indexVar="index">
                                        <aura:if isTrue="{!v.accItem.Phase_Number__c == nFacilityAccItemMulti.Phase_Number__c}">
                                            <c:CPFFacilityAccountSectionPhase aura:id="newFacilityAcc" accItem="{!nFacilityAccItemMulti}" rowindex="{!index}" newFacilityAccount="{!v.newFacilityAccountMulti}" Phasenumber="{!v.accItem.Phase_Number__c}" OppRecId="{!v.recordId}" AppPrdctCPFId="{!v.appProdCPFId}"/>
                                        </aura:if>
                                    </aura:iteration>
                                </span>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <span class="slds-m-top_medium">
                                    <lightning:button label="Add New Existing Account" onclick="{!c.addNewAccount}" variant="brand" aura:id="ibtn" />
                                </span>
                            </div>
                        </aura:if>
                        <div class="slds-col slds-size_1-of-2">
                            <span >
                                <label class="slds-form-element__label">
                                    <span class="slds-m-right_small">Other amounts included in total facility</span>
                                    <lightning:helptext icon-name="utility:like" content="Select Yes if existing account balance must be included in the Total Facility Limit" />
                                </label>
                                <c:DynamicPicklistValueRenderer aura:id="DynamicPicklist"
                                                                picklistfieldName="Other_amounts_included_in_total_facility__c"
                                                                objectName="Application_Phase_CPF__c"
                                                                value="{!v.accItem.Other_amounts_included_in_total_facility__c}" />
                            </span>
                        </div>
                        <aura:if isTrue="{!v.accItem.Other_amounts_included_in_total_facility__c=='Yes'}">
                            <div class="slds-col slds-size_1-of-2">
                                <span >
                                    <aura:iteration items="{!v.newFeesOtherFaciMulti}" var="nOtherFaciItemMulti" indexVar="index">
                                        <aura:if isTrue="{!v.accItem.Phase_Number__c == nOtherFaciItemMulti.Phase_Number__c}">
                                            <c:CPFOtherFeesPhase aura:id="newotherfeesIdFaci" otherfeesItem="{!nOtherFaciItemMulti}" rowindex="{!index}" otherfees="{!v.newFeesOtherFaciMulti}" 
                                                                 OppRecId="{!v.recordId}" Type="Facility" Phasenumber="{!v.accItem.Phase_Number__c}" AppPrdctCPFId="{!v.appProdCPFId}"/>
                                        </aura:if>
                                    </aura:iteration>
                                </span>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <span class="slds-m-top_medium">
                                    <lightning:button label="Add Other Amounts" onclick="{!c.addOtherfees}" variant="brand" aura:id="ibtn1" />
                                </span>
                            </div>
                        </aura:if>
                    </div>
                </lightning:recordEditForm>
            </lightning:accordionSection>
        </lightning:accordion>
        
        <lightning:accordion activeSectionName="Multiple Phase Repayment Requirements" allowMultipleSectionsOpen="false">
            <lightning:accordionSection name="Multiple Phase Repayment Requirements" label="Multiple Phase Repayment Requirements" >
                <lightning:recordEditForm aura:id="appPhasecpf" objectApiName="Application_Phase_CPF__c" recordId="{!v.accItem.Id}">
                    <div class="slds-grid slds-wrap slds-gutters_medium">
                        <div class="slds-col slds-size_1-of-2">
                            <span >
                                <label class="slds-form-element__label">
                                    <span class="slds-m-right_small">Final repayment date</span>
                                    <lightning:helptext icon-name="utility:like" content="Final Repayment Date: Option 1: In respect of the Facility, [DATE] Option 2: [The date falling [NUMBER] [days]/[month(s)/[years] after the date of first drawdown of the Facility.]Option 3: [The date falling [NUMBER] [days]/[month(s)]/[years] after the Signature Date.]" />
                                </label>
                                <lightning:inputField fieldName="Final_repayment_date__c" aura:id="finalrepaymentdatesingle" variant="label-hidden" value="{!v.accItem.Final_repayment_date__c}"/>
                            </span>
                        </div>
                        <aura:if isTrue="{!v.accItem.Final_repayment_date__c =='Date'}">
                            <div class="slds-col slds-size_1-of-2">
                                <span >
                                    <lightning:inputField fieldName="Date_of_final_repayment__c" aura:id="dateofFinalrepaymentsingle" value="{!v.accItem.Date_of_final_repayment__c}" />
                                </span>
                            </div>
                        </aura:if>
                        <aura:if isTrue="{!or(v.accItem.Final_repayment_date__c =='after the date of first drawdown',v.accItem.Final_repayment_date__c =='after the Signature Date')}">
                            <div class="slds-col slds-size_1-of-2">
                                <span >
                                    <lightning:inputField fieldName="Number_of_periods_months__c" aura:id="numberofPeriodsMonthssingle" value="{!v.accItem.Number_of_periods_months__c}"/>
                                </span>
                            </div>
                        </aura:if>
                        <div class="slds-col slds-size_1-of-2">
                            <span >
                                <label class="slds-form-element__label">
                                    <span class="slds-m-right_small">Interest rate basis</span>
                                    <lightning:helptext icon-name="utility:like" content="" />
                                </label>
                                <lightning:inputField fieldName="Interest_rate_basis__c" aura:id="interestratebasissingle" variant="label-hidden" value="{!v.accItem.Interest_rate_basis__c}"/>
                            </span>
                        </div>
                        <aura:if  isTrue="{!v.accItem.Interest_rate_basis__c == 'Fixed rate with net margin'}"  >
                            <div class="slds-col slds-size_1-of-2">
                                <span >
                                    <lightning:inputField fieldName="Net_margin__c" aura:id="netmarginsingle" value="{!v.accItem.Net_margin__c}"/>
                                </span>
                            </div>
                        </aura:if>
                        <aura:if  isTrue="{!v.accItem.Interest_rate_basis__c == 'Fixed rate with all in risk margin'}"  >
                            <div class="slds-col slds-size_1-of-2">
                                <span >
                                    <lightning:inputField fieldName="All_in_risk_margin__c" aura:id="allinriskmarginsingle" value="{!v.accItem.All_in_risk_margin__c}"/>
                                </span>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <span >
                                    <lightning:inputField fieldName="Fixed_rate_period__c" aura:id="fixedrateperiodsingle" value="{!v.accItem.Fixed_rate_period__c}" />
                                </span>
                            </div>
                        </aura:if>
                        <aura:if  isTrue="{!v.accItem.Interest_rate_basis__c == 'Prime Rate'}"  >
                            <div class="slds-col slds-size_1-of-2">
                                <span >
                                    <lightning:inputField fieldName="Prime_rate_margin__c" aura:id="primeratemarginsingle" value="{!v.accItem.Prime_rate_margin__c}"/>
                                </span>
                            </div>
                            <aura:if isTrue="{!or(v.accItem.Prime_rate_margin__c =='Plus per annum',v.accItem.Prime_rate_margin__c =='Minus per annum')}">
                                <div class="slds-col slds-size_1-of-2">
                                    <span >
                                        <lightning:inputField fieldName="Margin__c" aura:id="marginsingle" value="{!v.accItem.Margin__c}" />
                                    </span>
                                </div>
                            </aura:if>
                        </aura:if>
                        <div class="slds-col slds-size_1-of-2">
                            <span >
                                <label class="slds-form-element__label">
                                    <span class="slds-m-right_small">Repayment options during development</span>
                                    <lightning:helptext icon-name="utility:like" content="Select the applicable option" />
                                </label>
                                <lightning:inputField fieldName="Repayment_options_during_development__c" aura:id="repaymentoptionssingle" variant="label-hidden" onchange = "{!c.showFieldsRepaymentOptions}" value="{!v.accItem.Repayment_options_during_development__c}"/>
                            </span>
                        </div>
                        <aura:if  isTrue="{!or(v.showIntrestServiceFreqandAmt ,v.accItem.Repayment_options_during_development__c == 'Capitalised Interest with Bullet (No Conversion)' , v.accItem.Repayment_options_during_development__c == 'Capitalised Interest with Bullet (Converting)' ,
                                          v.accItem.Repayment_options_during_development__c == 'Interest only with a bullet capital repayment')}">
                            
                            <div class="slds-col slds-size_1-of-2">
                                <span >
                                    <label class="slds-form-element__label">
                                        <span class="slds-m-right_small">Interest service frequency</span>
                                        <lightning:helptext icon-name="utility:like" content="" />
                                    </label>
                                    <lightning:inputField fieldName="Interest_service_frequency__c" aura:id="interestservicefreqsingle"  variant="label-hidden" value="{!v.accItem.Interest_service_frequency__c}"/>
                                </span>
                            </div>  <div class="slds-col slds-size_1-of-2">
                            <span >
                                <label class="slds-form-element__label">
                                    <span class="slds-m-right_small">Final instalment amount</span>
                                    <lightning:helptext icon-name="utility:like" content="" />
                                </label>
                                <lightning:inputField fieldName="Final_instalment_amount__c" aura:id="finalinstalmentamtsingle"  variant="label-hidden" value="{!v.accItem.Final_instalment_amount__c}"/>
                            </span>
                            </div>
                        </aura:if>
                        <aura:if  isTrue="{!v.accItem.Repayment_options_during_development__c=='A period of interest only with capital and interest periods for the remaining term of the Facility	'}"  >
                            <div class="slds-col slds-size_1-of-2">
                                <span >
                                    <label class="slds-form-element__label">
                                        <span class="slds-m-right_small">Interest only period</span>
                                        <lightning:helptext icon-name="utility:like" content="" />
                                    </label>
                                    <lightning:inputField fieldName="Interest_only_period__c" aura:id="interestonlyperiodsingle"  variant="label-hidden" value="{!v.accItem.Interest_only_period__c}"/>
                                </span>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <span >
                                    <label class="slds-form-element__label">
                                        <span class="slds-m-right_small">Capital Repayments</span>
                                        <lightning:helptext icon-name="utility:like" content="After [INSERT] months, interest and capital shall be payable as further detailed in Schedule 3" />
                                    </label>
                                    <lightning:inputField fieldName="Capital_Repayments__c" aura:id="captialrepaysingle"  variant="label-hidden" value="{!v.accItem.Capital_Repayments__c}"/>
                                </span>
                            </div>
                        </aura:if>
                        <aura:if  isTrue="{!v.accItem.Repayment_options_during_development__c=='Capital and interest repayments'}"  >
                            <div class="slds-col slds-size_1-of-2">
                                <span >
                                    <label class="slds-form-element__label">
                                        <span class="slds-m-right_small">Interest and capital shall be payable as further detailed in Schedule 3.</span>
                                    </label>
                                </span>
                            </div>
                        </aura:if>
                        <aura:if  isTrue="{!v.accItem.Repayment_options_during_development__c=='Free flow'}"  >
                            <div class="slds-col slds-size_1-of-2">
                                <span >
                                    <label class="slds-form-element__label">
                                        <span class="slds-m-right_small">Free flow option</span>
                                        <lightning:helptext icon-name="utility:like" content="" />
                                    </label>
                                    <lightning:inputField fieldName="Free_flow_option__c" aura:id="freeflowoptionsingle"  variant="label-hidden" value="{!v.accItem.Free_flow_option__c}"/>
                                </span>
                            </div>
                        </aura:if>
                        <div class="slds-col slds-size_1-of-2">
                            <span >
                                <label class="slds-form-element__label">
                                    <span class="slds-m-right_small">Practical Completion Date</span>
                                    <lightning:helptext icon-name="utility:like" content="The date on which the Practical Completion Certificate in relation to the Development must be delivered to the Bank which shall be no later than [INSERT DATE]." />
                                </label>
                                <lightning:inputField fieldName="Practical_Completion_Date__c" aura:id="practicaldatesingle"  variant="label-hidden" value="{!v.accItem.Practical_Completion_Date__c}"/>
                            </span>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <span >
                                <label class="slds-form-element__label">
                                    <span class="slds-m-right_small">Development period months</span>
                                    <lightning:helptext icon-name="utility:like" content="Subject to the terms of the Facility Agreement, the Facility is available until the last day of a period of [NUMBER] month(s) calculated from the date of the fulfilment or waiver, as the case may be, of the Conditions Precedent or until the date 95 (ninety five) days post the Practical Completion Date Option: [, or until [DATE]]; whichever is earlier." />
                                </label>
                                <lightning:inputField fieldName="Development_period_months__c" aura:id="OVEr"  variant="label-hidden" value="{!v.accItem.Development_period_months__c}"/>
                            </span>
                        </div>
                    </div>
                </lightning:recordEditForm>
            </lightning:accordionSection>
        </lightning:accordion>
        <lightning:accordion activeSectionName="Multiple Phase Fees" allowMultipleSectionsOpen="false">
            <lightning:accordionSection name="Multiple Phase Fees" label="Multiple Phase Fees" >
                <lightning:recordEditForm aura:id="appPhasecpf" objectApiName="Application_Phase_CPF__c" recordId="{!v.accItem.Id}">
                    <div class="slds-grid slds-wrap slds-gutters_medium">
                        <div class="slds-col slds-size_1-of-2">
                            <span >
                                <label class="slds-form-element__label">
                                    <span class="slds-m-right_small">Cancellation fee payable (% of loan account)</span>
                                    <lightning:helptext icon-name="utility:like" content="[NUMBER]% of the Facility Amount payable if all the Conditions Precedent are not fulfilled, or waived by the Bank, within 60 (sixty) days of the Signature Date]." />
                                </label>
                                <lightning:inputField fieldName="Cancellation_fee_payable__c" aura:id="cancellationfeessingle"  variant="label-hidden" value="{!v.accItem.Cancellation_fee_payable__c}"/>
                            </span>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <span >
                                <label class="slds-form-element__label">
                                    <span class="slds-m-right_small">Admin Fee</span>
                                    <lightning:helptext icon-name="utility:like" content="R[AMOUNT] which is payable Option: [on Signature Date]/[on first drawdown of the Facility]/[by debit to the [Current Account]/ [Loan Account]." />
                                </label>
                                <c:DynamicPicklistValueRenderer aura:id="DynamicPicklist"
                                                                picklistfieldName="Admin_fee__c"
                                                                objectName="Application_Phase_CPF__c"
                                                                value="{!v.accItem.Admin_fee__c}"
                                                                />
                            </span>
                        </div>
                        <aura:if isTrue="{!v.accItem.Admin_fee__c == 'Yes'}">
                            <div class="slds-col slds-size_1-of-2">
                                <span >
                                    <lightning:inputField fieldName="Admin_fee_amount__c"  aura:id="adminAmtsingle" value="{!v.accItem.Admin_fee_amount__c}"/>
                                </span>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <span >
                                    <lightning:inputField fieldName="Payable__c"  aura:id="payablesingle" value="{!v.accItem.Payable__c}"/>
                                </span>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <span>
                                    <label class="slds-form-element__label">
                                        <span class="slds-m-right_small">Include Admin fee in total facility</span>
                                        <lightning:helptext icon-name="utility:like" content="Select Yes if the Admin fee must also be included in the Total Facility Amount." />
                                    </label>
                                    <c:DynamicPicklistValueRenderer aura:id="DynamicPicklist"
                                                                    picklistfieldName="Include_admin_fee_in_total_facility__c"
                                                                    objectName="Application_Product_CPF__c"
                                                                    value="{!v.accItem.Include_admin_fee_in_total_facility__c}"
                                                                    />
                                </span>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <span >
                                    <lightning:inputField fieldName="Account_type__c"  aura:id="accTypesingle" value="{!v.accItem.Account_type__c}"/>
                                </span>
                            </div>
                        </aura:if>
                        <div class="slds-col slds-size_1-of-2">
                            <span >
                                <label class="slds-form-element__label">
                                    <span class="slds-m-right_small">Restructure fee(%)</span>
                                    <lightning:helptext icon-name="utility:like" content="Option [NUMBER]% of the amount outstanding at the time, if the terms of the Facility are restructured as a result of an Event of Default or at the request of the Borrower." />
                                </label>
                                <lightning:inputField fieldName="Restructure_fee__c" aura:id="restruFeesingle" variant="label-hidden" value="{!v.accItem.Restructure_fee__c}" />
                            </span>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <span >
                                <label class="slds-form-element__label">
                                    <span class="slds-m-right_small">Commitment fee(%)</span>
                                    <lightning:helptext icon-name="utility:like" content="Commitment Fee: [NUMBER]% of the undrawn/uncancelled portion of the Facility Amount." />
                                </label>
                                <lightning:inputField fieldName="Commitment_fee__c" aura:id="commFeesingle" variant = "label-hidden"  value="{!v.accItem.Commitment_fee__c}"/>
                            </span>
                        </div>
                        <div class="slds-col slds-size_1-of-2">
                            <span >
                                <label class="slds-form-element__label">
                                    <span class="slds-m-right_small">Valuation fee</span>
                                    <lightning:helptext icon-name="utility:like" content="Valuation Fee: R[AMOUNT]" />
                                </label>
                                <c:DynamicPicklistValueRenderer aura:id="DynamicPicklist"
                                                                picklistfieldName="Valuation_fee__c"
                                                                objectName="Application_Phase_CPF__c"
                                                                picklistLabelName=""
                                                                value="{!v.accItem.Valuation_fee__c}"
                                                                />
                            </span>
                        </div>
                        <aura:if isTrue="{!or(v.accItem.Valuation_fee__c =='Yes', v.accItem.Valuation_fee__c =='Yes excluding VAT' )}">
                            <div class="slds-col slds-size_1-of-2">
                                <span >
                                    <label class="slds-form-element__label">
                                        <span class="slds-m-right_small">Valuation fee amount</span>
                                        <lightning:helptext icon-name="utility:like" content="R[AMOUNT]" />
                                    </label>
                                    <lightning:inputField fieldName="Valuation_fee_amount__c" aura:id="ValfeeAmtsingle" variant = "label-hidden" value="{!v.accItem.Valuation_fee_amount__c}"/>
                                </span>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <span >
                                    <label class="slds-form-element__label">
                                        <span class="slds-m-right_small">Include Valuation fee in total facility</span>
                                        <lightning:helptext icon-name="utility:like" content="Select Yes if the Admin fee must also be included in the Total Facility Amount." />
                                    </label>
                                    <c:DynamicPicklistValueRenderer aura:id="DynamicPicklist"
                                                                    picklistfieldName="Include_admin_fee_in_total_facility2__c"
                                                                    objectName="Application_Phase_CPF__c"
                                                                    value="{!v.accItem.Include_admin_fee_in_total_facility2__c}"
                                                                    />
                                </span>
                            </div>
                        </aura:if>
                        <div class="slds-col slds-size_1-of-2">
                            <span >
                                <label class="slds-form-element__label">
                                    <span class="slds-m-right_small">Prepayment fee</span>
                                    <lightning:helptext icon-name="utility:like" content="Prepayment Fee if the Facility (or any part thereof) is prepaid for any reason whatsoever after the first Drawdown date as follows:
                                                                                          i) [NUMBER]% of the Facility Amount prepaid during Year 1];
                                                                                          ii) [NUMBER]% of the Facility Amount prepaid during Year 2]; and
                                                                                          iii) [NUMBER]% of the Facility Amount prepaid during Year 3]" />
                                </label>
                                
                                <c:DynamicPicklistValueRenderer aura:id="DynamicPicklist"
                                                                picklistfieldName="Prepayment_fee__c"
                                                                objectName="Application_Phase_CPF__c"
                                                                picklistLabelName=""
                                                                value="{!v.accItem.Prepayment_fee__c}"
                                                                />
                            </span>
                        </div>
                        <aura:if isTrue="{!v.accItem.Prepayment_fee__c =='Yes'}">
                            <div class="slds-col slds-size_1-of-2">
                                <span >
                                    <label class="slds-form-element__label">
                                        <span class="slds-m-right_small">Early prepayment fee year 1</span>
                                        <lightning:helptext icon-name="utility:like" content="Prepayment Fee if the Facility (or any part thereof) is prepaid for any reason whatsoever after the first Drawdown date as follows:
                                                                                              i) [NUMBER]% of the Facility Amount prepaid during Year 1];" />
                                    </label>
                                    <lightning:inputField fieldName="Early_prepayment_fee_year_1__c" aura:id="earlyPrepFeeYr1single" variant="label-hidden" value="{!v.accItem.Early_prepayment_fee_year_1__c}" />
                                </span>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <span >
                                    <label class="slds-form-element__label">
                                        <span class="slds-m-right_small">Early prepayment fee year 2</span>
                                        <lightning:helptext icon-name="utility:like" content="Prepayment Fee if the Facility (or any part thereof) is prepaid for any reason whatsoever after the first Drawdown date as follows:
                                                                                              i) [NUMBER]% of the Facility Amount prepaid during Year 2];" />
                                    </label>
                                    <lightning:inputField fieldName="Early_prepayment_fee_year_2__c" aura:id="earlyPrepFeeYr2single" variant="label-hidden" value="{!v.accItem.Early_prepayment_fee_year_2__c}"/>
                                </span>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <span >
                                    <label class="slds-form-element__label">
                                        <span class="slds-m-right_small">Early prepayment fee year 3</span>
                                        <lightning:helptext icon-name="utility:like" content="Prepayment Fee if the Facility (or any part thereof) is prepaid for any reason whatsoever after the first Drawdown date as follows:
                                                                                              i) [NUMBER]% of the Facility Amount prepaid during Year 3];" />
                                    </label>
                                    <lightning:inputField fieldName="Early_prepayment_fee_year_3__c" aura:id="earlyPrepFeeYr3single" variant="label-hidden" value="{!v.accItem.Early_prepayment_fee_year_3__c}"/>
                                </span>
                            </div>
                        </aura:if>
                        <div class="slds-col slds-size_1-of-2">
                            <span >
                                <label class="slds-form-element__label">
                                    <span class="slds-m-right_small">Other Fees Applicable</span>
                                    <lightning:helptext icon-name="utility:like" content="Select Yes if other fees are applicable to this Loan" />
                                </label>
                                <c:DynamicPicklistValueRenderer aura:id="DynamicPicklist"
                                                                picklistfieldName="Other_fees_applicable__c"
                                                                objectName="Application_Phase_CPF__c"
                                                                picklistLabelName=""
                                                                value="{!v.accItem.Other_fees_applicable__c}"
                                                                />
                            </span>
                        </div>
                        <aura:if isTrue="{!v.accItem.Other_fees_applicable__c=='Yes'}">
                            <aura:iteration items="{!v.newFeesOtherFeesMulti}" var="nOtherFeesItemMulti" indexVar="index">
                                <aura:if isTrue="{!v.accItem.Phase_Number__c == nOtherFeesItemMulti.Phase_Number__c}">
                                    <c:CPFFeesPhase aura:id="newotherfeesId" otherfeesItem="{!nOtherFeesItemMulti}" rowindex="{!index}" otherfees="{!v.newFeesOtherFeesMulti}"
                                                    OppRecId="{!v.recordId}" Type="Fees Details" Phasenumber="{!v.accItem.Phase_Number__c}" AppPrdctCPFId="{!v.appProdCPFId}"/>
                                </aura:if>
                            </aura:iteration>
                            <div class="slds-col slds-size_1-of-2">
                                <span class="slds-m-top_medium">
                                    <lightning:button label="Add Other Fees" onclick="{!c.addOtherfeesbtn}" variant="brand" aura:id="ibtn1" />
                                </span>
                            </div>
                        </aura:if>
                        <div class="slds-col slds-size_1-of-2">
                            <span >
                                <label class="slds-form-element__label">
                                    <span class="slds-m-right_small">Drawdown inspection fee</span>
                                    <lightning:helptext icon-name="utility:like" content="Drawdown Inspection Fee in an amount of [AMOUNT], payable in relation to each drawdown, Option: which is due and payable on the date of such drawdown. / Option: which is indicative and will be confirmed upon receipt of the Property Valuation." />
                                </label>
                                <c:DynamicPicklistValueRenderer aura:id="DynamicPicklist"
                                                                picklistfieldName="Drawdown_inspection_fee__c"
                                                                objectName="Application_Phase_CPF__c"
                                                                picklistLabelName=""
                                                                value="{!v.accItem.Drawdown_inspection_fee__c}"
                                                                />
                            </span>
                        </div>
                        <aura:if isTrue="{!or(v.accItem.Drawdown_inspection_fee__c =='Fee on Drawdown',v.accItem.Drawdown_inspection_fee__c =='which is indicative')}">
                            <div class="slds-col slds-size_1-of-2">
                                <span >
                                    <label class="slds-form-element__label">
                                        <span class="slds-m-right_small">Drawdown inspection fee</span>
                                        <lightning:helptext icon-name="utility:like" content="Drawdown Inspection Fee in an amount of [AMOUNT], payable in relation to each drawdown, Option: which is due and payable on the date of such drawdown. / Option: which is indicative and will be confirmed upon receipt of the Property Valuation." />
                                    </label>
                                    <lightning:inputField fieldName="Drawdown_inspection_fee_cur__c" aura:id="drawdowninspfeesingle"  variant="label-hidden" value="{!v.accItem.Drawdown_inspection_fee_cur__c}"/>
                                </span>
                            </div>
                        </aura:if>
                    </div>
                </lightning:recordEditForm>
            </lightning:accordionSection>
        </lightning:accordion>
    </div>
</aura:component>